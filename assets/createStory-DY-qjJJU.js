import{p as me,aA as fe,aB as pe,g as ve,D as ge,aC as he,aD as xe,o as q,x as _,G as J,u as Ve,aE as Y,c as e,aF as be,M as ye,A as _e,N as we,P as Me,Q as m,R as f,S as l,ad as ke,a2 as n,_ as p,U as u,a1 as h,aG as x,ai as j,a0 as r,T as Ce,ab as Se,ag as Pe,ae as qe,af as Le}from"./index-8Uiqhuyy.js";import{c as Te,d as Z,a as I,e as Ne,f as W,u as Ue,b}from"./vee-validate.esm-B_JmCUxn.js";import{_ as Fe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ze}from"./VContainer-CSikmqFk.js";import{V as Re}from"./VDivider-CwA7EXwJ.js";import{V as v,a as g}from"./VRow-CNdGgXlO.js";import{V as Ie}from"./VTextarea-DOhRxgbA.js";import{V as Q,a as ee,b as H}from"./VRadioGroup-CfTPX7v_.js";import{V as Ae}from"./VForm-Bfo4Hgj4.js";import"./VList-BwhdeaOv.js";import"./VMenu-BqWCkneE.js";import"./VSelectionControl-DdSl2QiM.js";import"./VChip-BE6El_NJ.js";import"./VSlideGroup-B78MCx7J.js";const Be=me({id:String,text:String,...fe(pe({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),Oe=ve()({name:"VTooltip",props:Be(),emits:{"update:modelValue":o=>!0},setup(o,N){let{slots:w}=N;const L=ge(o,"modelValue"),{scopeId:A}=he(),U=xe(),T=q(()=>o.id||`v-tooltip-${U}`),V=_(),F=q(()=>o.location.split(" ").length>1?o.location:o.location+" center"),d=q(()=>o.origin==="auto"||o.origin==="overlap"||o.origin.split(" ").length>1||o.location.split(" ").length>1?o.origin:o.origin+" center"),B=q(()=>o.transition?o.transition:L.value?"scale-transition":"fade-transition"),O=q(()=>J({"aria-describedby":T.value},o.activatorProps));return Ve(()=>{const z=Y.filterProps(o);return e(Y,J({ref:V,class:["v-tooltip",o.class],style:o.style,id:T.value},z,{modelValue:L.value,"onUpdate:modelValue":M=>L.value=M,transition:B.value,absolute:!0,location:F.value,origin:d.value,persistent:!0,role:"tooltip",activatorProps:O.value,_disableGlobalStack:!0},A),{activator:w.activator,default:function(){var C;for(var M=arguments.length,k=new Array(M),y=0;y<M;y++)k[y]=arguments[y];return((C=w.default)==null?void 0:C.call(w,...k))??o.text}})}),be({},V)}}),le=o=>(qe("data-v-c29eb880"),o=o(),Le(),o),$e=le(()=>n("h2",null,"創作新故事",-1)),De={class:"me-2"},Ge={class:"d-flex align-center"},Ee=le(()=>n("div",{class:"tooltip-content"},[n("p",null,[n("strong",null,"詩")]),n("ul",null,[n("li",null,"短詩：50字以内"),n("li",null,"長詩：數百到數千字")]),n("p",null,[n("strong",null,"小說")]),n("ul",null,[n("li",null,"短篇小說：1,000到20,000字（通常3,000到7,500字之間）"),n("li",null,"中篇小說：20,000到50,000字"),n("li",null,"長篇小說：超過50,000字（通常80,000到120,000字之間）")]),n("p",null,[n("strong",null,"短品（散文、隨筆等）")]),n("ul",null,[n("li",null,"短篇散文：500到2,000字"),n("li",null,"隨筆：1,000到5,000字")])],-1)),je={class:"d-flex align-center"},Qe={class:"d-flex align-center"},He={__name:"createStory",setup(o){const N=Pe(),w=ye(),L=()=>{w.isLogin?N.push("/createStory"):N.push("/login")};_e(()=>{L()});const{apiAuth:A}=ke(),U=we(),T=_(null),V=_([]),F=_([]),d=["totalWordCount","title","chapterName","content","category","chapterLabels","state","show","fileRecords"],B=Te({totalWordCount:Z().required("文章總字數必填").typeError("文章總字數必須是數字").positive("文章總字數必須是正數").integer("文章總字數必須是整數").min(1,"文章總字數不能為 0").max(5e6,"總字數不能超過 500 萬字"),title:I().required("故事名稱必填"),chapterName:I().required("章節名稱必填"),content:I().required("內容必填").test("max-length",function(){return`不能超過 ${P.value} 個字`},function(t){return t.length<=P.value}),category:I().required("作品分類必填"),chapterLabels:Ne().min(1,"至少需要選擇一個標籤").required("作品標籤必填"),state:W().required("狀態必填"),show:W().required("顯示方式必填"),voteTime:Z().required("投票時間必填").min(10)}),{handleSubmit:O,isSubmitting:z,resetForm:M}=Ue({validationSchema:B,initialValues:{totalWordCount:0,title:"",chapterName:"",content:"",voteTime:1e3*5*60,category:"",chapterLabels:[],state:!1,show:!0}}),k=b("title"),y=b("chapterName"),C=b("voteTime"),$=b("category"),D=b("chapterLabels"),G=b("state"),E=b("show"),R=b("totalWordCount"),S=b("content"),P=q(()=>{const t=Number(R.value.value);return Math.max(1,Math.floor(t/10))}),te=()=>{S.value.value.length>P.value&&(S.value.value=S.value.value.slice(0,P.value))},ae=_(["愛情","奇幻玄幻","科幻未來","驚悚推理","靈異恐怖","武俠仙俠","都市","LGBTQ+","勵志成長","幽默諷喻","影視","同人","網遊","歷史傳記","軍事戰爭","生活風格","親子共享","藝術設計","科普","商業理財","文藝評論","其他"]),se=_(["不限","戀愛","異界","校園","戰鬥","冒險","魔法","異能","超能力","超自然","重生","穿越","爽文/輕鬆","搞笑","虐心","復仇","靈異神怪","暗黑","恐怖","奇幻","異世界轉生","逆襲","未來世界","英雄","百合","同志","日常","科幻","成長","家庭","友情","偵探","職場","青梅竹馬","後宮","妖怪","節操","二創","悲劇","喜劇","異國","輕小說","心理","神話","蒸汽龐克","時間旅行","機器人","人工智能","動物"]),re=_([{title:"10 秒",value:1e3*10},{title:"20 秒",value:1e3*20},{title:"5 分鐘",value:1e3*5*60},{title:"10 分鐘",value:1e3*10*60},{title:"30 分鐘",value:1e3*30*60},{title:"1 小時",value:1e3*60*60},{title:"2 小時",value:1e3*2*60*60},{title:"4 小時",value:1e3*4*60*60},{title:"8 小時",value:1e3*8*60*60},{title:"12 小時",value:1e3*12*60*60},{title:"24 小時",value:1e3*24*60*60},{title:"36 小時",value:1e3*36*60*60}]),oe=()=>{M(),T.value.deleteFileRecord()},ne=t=>{let a,c,s;if(t<=1e3)a=Math.ceil(t/200),c=Math.ceil(t/a),s=50;else if(t<=4e4)a=Math.ceil(t/3e3),c=Math.ceil(t/a),s=300;else if(t<=1e5)a=Math.ceil(t/5e3),c=Math.ceil(t/a),s=500;else if(t<=3e5)a=Math.ceil(t/7e3),c=Math.ceil(t/a),s=1e3;else if(t<=6e5)a=Math.ceil(t/1e4),c=Math.ceil(t/a),s=2e3;else if(t<=1e6)a=Math.ceil(t/15e3),c=Math.ceil(t/a),s=3e3;else if(t<=2e6)a=Math.ceil(t/2e4),c=Math.ceil(t/a),s=4e3;else if(t<=5e6)a=Math.ceil(t/3e4),c=Math.ceil(t/a),s=5e3;else throw new Error("總字數超出範圍 (最多 5,000,000 字)。");return{chapters:a,wordsPerChapter:c,extendWordLimit:s}},ie=t=>t.length,ue=O(async t=>{var s,K,X;t.totalWordCount=Number(t.totalWordCount);const a=ne(t.totalWordCount),c=ie(t.content);if((s=V.value[0])!=null&&s.error){console.log("文件錯誤：",V.value[0].error);return}try{const i=new FormData;i.append("totalWordCount",t.totalWordCount),i.append("title",t.title),i.append("chapterName",t.chapterName),i.append("content",t.content),i.append("voteTime",t.voteTime),i.append("category",t.category);for(const de of t.chapterLabels)i.append("chapterLabels",de);i.append("state",t.state),i.append("show",t.show),V.value.length>0&&i.append("image",V.value[0].file),i.append("chapters",a.chapters),i.append("wordsPerChapter",a.wordsPerChapter),i.append("extendWordLimit",a.extendWordLimit),i.append("currentChapterWordCount",c),console.log("FormData 內容：",Object.fromEntries(i));const ce=await A.post("/story",i);console.log("API 響應：",ce.data),U({text:"新增成功",snackbarProps:{color:"green"}}),oe()}catch(i){console.error("提交表單時發生錯誤:",i),U({text:((X=(K=i==null?void 0:i.response)==null?void 0:K.data)==null?void 0:X.message)||"發生錯誤",snackbarProps:{color:"red"}})}});return(t,a)=>{const c=Me("vue-file-agent");return m(),f(ze,{style:{padding:"32px"}},{default:l(()=>[$e,e(Re,{class:"mb-5"}),e(Ae,{onSubmit:Se(r(ue),["prevent"]),disabled:r(z),style:{padding:"10px 20px"}},{default:l(()=>[e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center w-100"},{default:l(()=>[n("div",De,[d.includes("totalWordCount")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[u("mdi-asterisk")]),_:1})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("總字數")]),_:1})]),n("div",Ge,[e(j,{"max-width":"600px",type:"number",class:"flex-grow-1",modelValue:r(R).value.value,"onUpdate:modelValue":a[0]||(a[0]=s=>r(R).value.value=s),"error-messages":r(R).errorMessage.value,maxlength:5e6,required:""},null,8,["modelValue","error-messages"]),e(Oe,{location:"bottom"},{activator:l(({props:s})=>[e(p,J({class:"mdi mdi-lightbulb-outline"},s),null,16)]),default:l(()=>[Ee]),_:1})])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("title")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[u("mdi-asterisk")]),_:1})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("故事名")]),_:1}),e(j,{"max-width":"600px",class:"flex-grow-1",modelValue:r(k).value.value,"onUpdate:modelValue":a[1]||(a[1]=s=>r(k).value.value=s),"error-messages":r(k).errorMessage.value,required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("chapterName")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[u("mdi-asterisk")]),_:1})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("章節名稱")]),_:1}),e(j,{class:"flex-grow-1",modelValue:r(y).value.value,"onUpdate:modelValue":a[2]||(a[2]=s=>r(y).value.value=s),"error-messages":r(y).errorMessage.value,required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("content")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[u("mdi-asterisk")]),_:1})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("起始故事")]),_:1}),e(Ie,{class:"flex-grow-1",counter:P.value,modelValue:r(S).value.value,"onUpdate:modelValue":a[3]||(a[3]=s=>r(S).value.value=s),"error-messages":r(S).errorMessage.value,maxlength:P.value,onInput:te,"auto-grow":"",required:""},null,8,["counter","modelValue","error-messages","maxlength"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("category")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[u("mdi-asterisk")]),_:1})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("投票時間")]),_:1}),e(Q,{class:"flex-grow-1","hide-details":"",modelValue:r(C).value.value,"onUpdate:modelValue":a[4]||(a[4]=s=>r(C).value.value=s),"error-messages":r(C).errorMessage.value,items:re.value,required:""},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("category")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[u("mdi-asterisk")]),_:1})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("作品分類")]),_:1}),e(Q,{class:"flex-grow-1","hide-details":"",modelValue:r($).value.value,"onUpdate:modelValue":a[5]||(a[5]=s=>r($).value.value=s),"error-messages":r($).errorMessage.value,items:ae.value,required:""},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("chapterLabels")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[u("mdi-asterisk")]),_:1})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("作品標籤")]),_:1}),e(Q,{class:"flex-grow-1",multiple:"",chips:"","hide-details":"",modelValue:r(D).value.value,"onUpdate:modelValue":a[6]||(a[6]=s=>r(D).value.value=s),"error-messages":r(D).errorMessage.value,items:se.value,required:""},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("state")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[u("mdi-asterisk")]),_:1})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("故事狀態")]),_:1}),e(ee,{class:"d-flex align-center flex-grow-2",row:"","hide-details":"",modelValue:r(G).value.value,"onUpdate:modelValue":a[7]||(a[7]=s=>r(G).value.value=s),"error-messages":r(G).errorMessage.value},{default:l(()=>[n("div",je,[e(H,{label:"連載中",value:!1})])]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("show")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[u("mdi-asterisk")]),_:1})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("顯示方式")]),_:1}),e(ee,{class:"d-flex align-center flex-grow-1",row:"","hide-details":"",modelValue:r(E).value.value,"onUpdate:modelValue":a[8]||(a[8]=s=>r(E).value.value=s),"error-messages":r(E).errorMessage.value},{default:l(()=>[n("div",Qe,[e(H,{label:"公開",value:!0,class:"me-4"}),e(H,{label:"隱藏",value:!1})])]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("fileRecords")?(m(),f(p,{key:0,class:"me-2",style:{color:"red"},size:"12px",icon:"mdi-asterisk"})):h("",!0),e(x,{class:"me-4 mb-0"},{default:l(()=>[u("封面圖片")]),_:1}),e(c,{modelValue:V.value,"onUpdate:modelValue":a[9]||(a[9]=s=>V.value=s),"raw-model-value":F.value,"onUpdate:rawModelValue":a[10]||(a[10]=s=>F.value=s),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:T},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),e(v,null,{default:l(()=>[e(g,{cols:"12",class:"d-flex justify-center"},{default:l(()=>[e(Ce,{type:"submit",loading:r(z),style:{"background-color":"#4e9194",color:"#ffffff"}},{default:l(()=>[u("發布")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})}}},il=Fe(He,[["__scopeId","data-v-c29eb880"]]);export{il as default};
