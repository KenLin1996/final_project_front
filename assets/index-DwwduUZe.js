import{a2 as oe,O as ge,P as i,Q as w,R as t,c as e,V as ve,a0 as l,a3 as R,T as u,Y as c,a4 as B,a5 as L,x as _,Z as F,S as V,G as N,U as b,W as $,X as j,a6 as U,N as ye,o as W,a7 as H,a8 as be,_ as we,a9 as Ve,aa as ke,$ as C,ab as Ce,ac as ne,ad as $e,ae as Se}from"./index-BQtH6iZV.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as je}from"./VChip-CvazLWZ2.js";import{c as Ie,a as ee,u as Te,b as te}from"./vee-validate.esm-DhJukTDA.js";import{V as Ae}from"./VMenu-DcIoYLm7.js";import{V as ce,a as ue,b as ie}from"./VList-CT45dZ_r.js";import{V as De,a as ze,b as ae,c as Ne}from"./VExpansionPanels-L6YgJiot.js";import{V as y,a as n}from"./VRow-BcLcHuOe.js";import{V as Be}from"./VForm-Cowh1Gba.js";import{V as Me}from"./VTextarea-DVEBbIvj.js";import{V as D}from"./VContainer-BM79zw4O.js";import{V as z}from"./VDivider-C5116G8z.js";import"./VSlideGroup-ClZW227d.js";const Ee={class:"d-flex justify-space-between align-center"},Pe={__name:"BookCard",props:["_id","image","title","category","mainAuthor","content"],setup(a){const S=oe(),r=x=>{S.push(x)};return(x,d)=>{const h=ge("router-link");return i(),w(L,{class:"pa-3 customMargin","max-width":"200"},{default:t(()=>[e(h,{to:"/stories/"+a._id},{default:t(()=>[e(ve,{class:"cursor-pointer",height:"150px",src:a.image,cover:""},null,8,["src"])]),_:1},8,["to"]),l("div",Ee,[e(R,{class:"px-0 py-1 text-subtitle-1 cursor-pointer",onClick:d[0]||(d[0]=v=>r("/123"))},{default:t(()=>[u(c(a.title),1)]),_:1}),e(je,{density:"compact",color:"primary",label:"true",style:{"font-size":"12px",padding:"2px 6px"}},{default:t(()=>[u(c(a.category),1)]),_:1})]),e(B,{class:"pa-0 cursor-pointer",style:{"font-size":"12px",color:"#4e9194"},onClick:d[1]||(d[1]=v=>r("/1234"))},{default:t(()=>{var v;return[u(c((v=a.mainAuthor)==null?void 0:v.username),1)]}),_:1}),e(B,{class:"pa-0"},{default:t(()=>[u(c(a.content[0].content[0]),1)]),_:1})]),_:1})}}},le=q(Pe,[["__scopeId","data-v-57fa2598"]]),Fe={class:"title-row"},Re={class:"title-text"},Le={class:"card-title my-1"},We={class:"vote-section"},He={class:"vote-count text-body-2"},Ue={__name:"VoteItem",props:["content","chapterName","author"],setup(a){const S=_([{title:"檢舉"},{title:"刪除"}]),r=_(0),x=_(!1),d=_(!0),h=()=>{r.value+=1,x.value=!0,d.value=!1},v=()=>{r.value-=1,x.value=!1,d.value=!0};return(s,g)=>(i(),w(L,{class:"w-100 px-6 py-2 rounded-lg",style:{border:"1px solid #48a9a6",margin:"16px 0px"}},{default:t(()=>[e(R,{class:"pa-0"},{default:t(()=>{var k;return[l("div",Fe,[l("div",Re,[l("h1",Le,c((k=a.author)==null?void 0:k.username),1)]),l("div",We,[e(F,{class:"vote-icon",size:"20"},{default:t(()=>[u("mdi-vote")]),_:1}),l("span",He,c(r.value),1),e(Ae,{location:"end"},{activator:t(({props:I})=>[e(V,N({icon:""},I,{class:"menu-btn",style:{width:"30px",height:"30px",padding:"auto"},variant:"plain"}),{default:t(()=>[e(F,{size:"20"},{default:t(()=>[u("mdi-dots-vertical")]),_:1})]),_:2},1040)]),default:t(()=>[e(ce,{class:"pa-0"},{default:t(()=>[(i(!0),b($,null,j(S.value,(I,E)=>(i(),w(ue,{key:E,class:""},{default:t(()=>[e(ie,null,{default:t(()=>[u(c(I.title),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]}),_:1}),e(B,{class:"pa-0 mx-7 py-1"},{default:t(()=>{var k;return[u(c((k=a.content)==null?void 0:k[0].latestContent),1)]}),_:1}),e(U,{class:"d-flex justify-end"},{default:t(()=>[e(V,{disabled:x.value,style:{"background-color":"#f24e1e",color:"white"},onClick:h},{default:t(()=>[u("投票")]),_:1},8,["disabled"]),e(V,{disabled:d.value,style:{"background-color":"#f4b942",color:"black","margin-right":"24px"},onClick:v},{default:t(()=>[u("取消")]),_:1},8,["disabled"])]),_:1})]),_:1}))}},qe=q(Ue,[["__scopeId","data-v-63358c88"]]),M=a=>($e("data-v-8364d100"),a=a(),Se(),a),Ge={class:"text--muted"},Ye={class:"font-weight-black",style:{"font-size":"16px","margin-right":"4px"}},Oe=M(()=>l("br",null,null,-1)),Qe={key:0,class:"text--danger my-2 d-inline-block font-weight-black",style:{"font-size":"12px"}},Xe=M(()=>l("br",null,null,-1)),Ze={style:{color:"#4e9194","margin-right":"10px","font-size":"14px"}},Je=M(()=>l("br",null,null,-1)),Ke={key:0,class:"my-2 d-inline-block",style:{color:"black","margin-right":"10px"}},et=M(()=>l("br",null,null,-1)),tt={style:{color:"black","margin-right":"10px"}},at=M(()=>l("h1",null,"故事投票",-1)),lt={__name:"StoryItem",props:["category","title","chapterName","mainAuthor","content","createdAt","extensions","_id","voteTime"],setup(a){const{api:S,apiAuth:r}=ne(),x=_(null),d=_(null),h=ye(),v=oe(),s=_(100),g=_(500),k=Ie({newChapterName:ee().required("章節名稱必填").min(1).max(60),newChapterContent:ee().required("故事內容必填").min(s.value,`故事內容不能少於 ${s.value} 字`).max(g.value,`故事內容不能超過 ${g.value} 字`)}),{handleSubmit:I,isSubmitting:E}=Te({validationSchema:k,initialValues:{newChapterContent:""}}),G=te("newChapterName"),Y=te("newChapterContent"),P=_(!1),T=_(!1),{category:rt,title:dt,chapterName:ft,mainAuthor:pt,content:mt,_id:O,extensions:ht,voteTime:re}=a,de=()=>{P.value=!P.value},fe=W(()=>P.value?"mdi-heart":"mdi-heart-outline"),pe=()=>{T.value=!0},me=W(()=>[p=>p.length>=s.value&&p.length<=g.value||`內容字數需在 ${s.value} 至 ${g.value} 字之間`]),Q=W(()=>{if(!d.value)return"";const p=new Date,f=new Date(d.value)-p;if(f<=0)return"投票已結束";const o=Math.floor(f/1e3),X=Math.floor(o/(24*3600)),Z=Math.floor(o%(24*3600)/3600),J=Math.floor(o%3600/60),K=o%60,A=[];return X>0&&A.push(`${X} 天`),Z>0&&A.push(`${Z} 小時`),J>0&&A.push(`${J} 分`),K>0&&A.push(`${K} 秒`),A.join(" ")}),he=async()=>{const p=new Date,m=new Date(p.getTime()+re);try{await r.patch(`/story/${O}/startVote`,{voteStart:p,voteEnd:m}),x.value=p,d.value=m,console.log("Vote Start:",x.value),console.log("Vote End:",d.value)}catch(f){console.log("Failed to update vote time:",f)}},_e=_(null),xe=I(async p=>{var m,f;console.log("Submitting with values:",p);try{const o=await r.post(`/story/${O}`,{chapterName:p.newChapterName,content:p.newChapterContent});console.log("API Response:",o),await he(),h({text:"延伸內容提交成功",snackbarProps:{color:"green"}}),T.value=!1,v.push("/"),_e.value=o.data,h({text:"延伸內容提交成功",snackbarProps:{color:"green"}}),T.value=!1,v.push("/")}catch(o){console.log(o),h({text:((f=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:f.message)||"發生錯誤",snackbarProps:{color:"red"}})}});return console.log(Q.value),(p,m)=>(i(),w(Ne,{class:"customMb"},{default:t(()=>[e(De,null,{default:t(()=>[e(ze,null,{default:t(()=>[e(y,{"no-gutters":""},{default:t(()=>[e(n,{class:"d-flex align-center justify-center text--secondary",style:{"padding-right":"24px"},cols:"1"},{default:t(()=>[l("div",Ge,c(a.category),1)]),_:1}),e(n,{cols:"8",class:"text--secondary"},{default:t(()=>[l("span",Ye,c(a.title),1),Oe,a.extensions&&a.extensions.length>0?(i(),b("span",Qe,"投票倒數計時：")):H("",!0),Xe,l("span",null,c(a.chapterName),1)]),_:1}),e(n,{cols:"3",class:"text-right",style:{color:"#4e9194"}},{default:t(()=>{var f;return[l("span",Ze,c((f=a.mainAuthor)==null?void 0:f.username),1),Je,a.extensions&&a.extensions.length>0?(i(),b("span",Ke,c(Q.value),1)):H("",!0),et,l("span",tt,c(new Date(a.createdAt).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})),1)]}),_:1})]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(y,{style:{padding:"12px"}},{default:t(()=>[e(n,{cols:"12",class:"mt-1 pa-0",style:{"font-size":"8px"}},{default:t(()=>[l("h1",null,c(a.content[0].latestContent?"最新內容":"開始故事"),1)]),_:1}),e(n,{cols:"12"},{default:t(()=>[e(y,null,{default:t(()=>[e(n,{cols:"1",class:"d-flex align-center justify-center pa-0"},{default:t(()=>[e(V,{text:"",ripple:!1,variant:"text",class:be(["heart-button pa-0",{filled:P.value}]),onClick:de},{default:t(()=>[e(F,null,{default:t(()=>[u(c(fe.value),1)]),_:1})]),_:1},8,["class"])]),_:1}),e(n,{cols:"11",class:"pl-0"},{default:t(()=>{var f;return[l("p",null,c(a.content[0].latestContent?a.content[0].latestContent:(f=a.content[0])==null?void 0:f.content[0]),1),e(U,null,{default:t(()=>[e(we),e(V,{color:"secondary",variant:"outlined",onClick:pe},{default:t(()=>[u(" 延續故事 ")]),_:1})]),_:1}),e(Ve,{modelValue:T.value,"onUpdate:modelValue":m[2]||(m[2]=o=>T.value=o),"max-width":"500"},{default:t(()=>[e(Be,{onSubmit:ke(C(xe),["prevent"]),disabled:C(E)},{default:t(()=>[e(L,null,{default:t(()=>[e(R,{class:"text-center",style:{"background-color":"#97d8c4"}},{default:t(()=>[u("延續故事")]),_:1}),e(B,{class:"py-4 pb-0"},{default:t(()=>[e(Ce,{modelValue:C(G).value.value,"onUpdate:modelValue":m[0]||(m[0]=o=>C(G).value.value=o),class:"mb-4",label:"輸入章節名稱","hide-details":"",minlength:1,maxlength:60},null,8,["modelValue"]),e(Me,{modelValue:C(Y).value.value,"onUpdate:modelValue":m[1]||(m[1]=o=>C(Y).value.value=o),label:`故事內容（字數：${s.value} - ${g.value} 字`,rows:"10",minlength:`${s.value}`,maxlength:`${g.value}`,counter:"",rules:me.value,style:{"margin-bottom":"8px"}},null,8,["modelValue","label","minlength","maxlength","rules"])]),_:1}),e(U,{class:"justify-center align-start py-0"},{default:t(()=>[e(V,{style:{"background-color":"#4e9194",color:"#000000"},type:"submit",loading:C(E)},{default:t(()=>[u("發布")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a.extensions&&a.extensions.length>0?(i(),w(ae,{key:0},{default:t(()=>[e(n,{cols:"12",class:"mt-1 mb-3 pa-0",style:{"font-size":"8px"}},{default:t(()=>[at]),_:1}),(i(!0),b($,null,j(a.extensions.slice(0,5),(f,o)=>(i(),w(qe,N({key:o,ref_for:!0},f),null,16))),128))]),_:1})):H("",!0)]),_:1})]),_:1}))}},se=q(lt,[["__scopeId","data-v-8364d100"]]),st={class:"pa-0 px-4"},ot=l("h2",null,"追蹤故事",-1),nt=l("h2",null,"熱門故事",-1),ct=l("h2",null,"最新故事",-1),ut=l("h2",null,"完結故事",-1),it=l("h2",null,"創作資源區",-1),It={__name:"index",setup(a){const{api:S}=ne(),r=_([]),x=async()=>{try{const{data:h}=await S.get("/story");r.value.splice(0,r.value.length,...h.result.data)}catch(h){console.log(h)}},d=[{to:"/articleArea",icon:"mdi-lightbulb-on-outline",title:"創作指引",color:"#F9A825"},{to:"/characterSet",icon:"mdi-account-box-outline",title:"人物設定",color:"#000000"}];return x(),(h,v)=>(i(),b($,null,[e(y,null,{default:t(()=>[e(n,{cols:"12"},{default:t(()=>[e(L,{class:"rounded-0 px-10 py-auto",height:"200px",color:"surface-variant",image:"https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=2948&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",cover:"",elevation:"5"},{default:t(()=>[e(n,null,{default:t(()=>[e(R,{class:"text-h4 font-weight-bold"},{default:t(()=>[u(" 歡迎來到界筆！ ")]),_:1}),e(B,{class:"font-weight-bold pa-0 py-2 px-4 mb-2",style:{"font-size":"24px","letter-spacing":"12px"}},{default:t(()=>[u(" 探索和創作無限可能的故事 ")]),_:1}),l("div",st,[e(V,{class:"font-weight-black mr-3 px-4",variant:"elevated",color:"#CCB78E",to:"/createStory"},{default:t(()=>[u(" 立即創作 ")]),_:1}),e(V,{class:"font-weight-black px-4",outlined:"",border:"",variant:"elevated",style:{color:"#ccb78e",border:"1px solid #ccb78e","background-color":"rgba(0, 0, 0, 0.47)"},to:"/category"},{default:t(()=>[u(" 探索故事 ")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(D,{style:{padding:"32px"}},{default:t(()=>[e(y,{class:"justify-space-between"},{default:t(()=>[e(n,{cols:"12",class:"pb-0"},{default:t(()=>[ot]),_:1}),e(z,{class:"mb-3"}),e(n,{cols:"12",class:"d-flex flex-row justify-space-between"},{default:t(()=>[e(se)]),_:1})]),_:1})]),_:1}),e(D,{style:{padding:"32px"}},{default:t(()=>[e(y,{class:"justify-space-between"},{default:t(()=>[e(n,{cols:"12",class:"pb-0"},{default:t(()=>[nt]),_:1}),e(z,{class:"mb-3"}),e(n,{cols:"12",class:"d-flex flex-row justify-start"},{default:t(()=>[(i(!0),b($,null,j(r.value,s=>(i(),w(le,N({key:s._id,ref_for:!0},s),null,16))),128))]),_:1})]),_:1})]),_:1}),e(D,{style:{padding:"32px"}},{default:t(()=>[e(y,{class:"justify-space-between"},{default:t(()=>[e(n,{cols:"12",class:"pb-0"},{default:t(()=>[ct]),_:1}),e(z,{class:"mb-3"}),e(n,{cols:"12",class:"d-flex flex-column justify-space-between"},{default:t(()=>[(i(!0),b($,null,j(r.value,(s,g)=>(i(),w(se,N({key:g,ref_for:!0},s),null,16))),128))]),_:1})]),_:1})]),_:1}),e(D,{style:{padding:"32px"}},{default:t(()=>[e(y,{class:"justify-space-between"},{default:t(()=>[e(n,{cols:"12",class:"pb-0"},{default:t(()=>[ut]),_:1}),e(z,{class:"mb-3"}),e(n,{cols:"12",class:"d-flex flex-row justify-space-between"},{default:t(()=>[(i(!0),b($,null,j(r.value,s=>(i(),w(le,N({key:s._id,ref_for:!0},s),null,16))),128))]),_:1})]),_:1})]),_:1}),e(D,{style:{padding:"32px"}},{default:t(()=>[e(y,{class:"justify-space-between"},{default:t(()=>[e(n,{cols:"12",class:"pb-0"},{default:t(()=>[it]),_:1}),e(z,{class:"mb-3"}),e(n,{cols:"12",class:"d-flex flex-row justify-space-between py-0"},{default:t(()=>[e(ce,{class:"d-flex justify-space-between w-100 py-0",style:{"background-color":"transparent"}},{default:t(()=>[(i(),b($,null,j(d,(s,g)=>e(ue,{key:g,to:s.to,link:""},{prepend:t(()=>[e(F,{size:"80",color:s.color},{default:t(()=>[u(c(s.icon),1)]),_:2},1032,["color"])]),default:t(()=>[e(ie,{style:{"font-size":"20px","font-weight":"bold"},textContent:c(s.title)},null,8,["textContent"])]),_:2},1032,["to"])),64))]),_:1})]),_:1})]),_:1})]),_:1})],64))}};export{It as default};
