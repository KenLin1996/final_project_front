import{M as F,N as K,x as m,A as Q,ab as X,R as u,X as w,c as a,T as o,aQ as Z,Y as N,a7 as _,V as f,a4 as s,_ as n,W as d,S as v,U as y,a3 as j,Z as B,G as H,a2 as A,ac as Y,O as $,a8 as J}from"./index-D7Ak4P4d.js";import{m as E,S as tt}from"./StoryItem-0zrn_uJm.js";import{V as et}from"./VContainer-D_j6Yqpc.js";import{V as L,a as c}from"./VRow-D61Wexp4.js";import{V as M}from"./VChip-DHYB_887.js";import{V as x}from"./VDivider-C137Yh-_.js";import{V as at}from"./VTextarea-C_1aVLGw.js";import{a as ot}from"./VList-DdlcFOqs.js";import"./vee-validate.esm-n0mYqsAE.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./VMenu-Cm7ojpY7.js";import"./VSlideGroup-C-eF75Vm.js";const st={class:"blue--text text-h5"},lt=s("strong",null,"作者：",-1),rt={class:"blue--text"},nt=s("strong",null,"類別：",-1),ct=s("strong",null,"狀態：",-1),ut={class:"orange--text"},it=s("strong",null,"總字數：",-1),dt={class:"grey--text"},pt={class:"my-2"},mt=s("h3",{class:""},"起始故事",-1),_t={class:"py-4"},vt=s("h3",{class:""},"故事投票",-1),ht=s("h3",{class:"pa-4",style:{"background-color":"rgb(146 224 227)"}},"留言區",-1),gt={class:""},ft={class:"pa-4"},yt=s("span",null,"貓界阿宅",-1),xt=s("p",{class:"ml-13 text-body-2"},"這是本喵看過最好看的喵喵喵喵書",-1),bt={class:"pa-4"},kt=s("span",null,"黑嚕嚕咕嚕嚕",-1),Vt=s("p",{class:"ml-13 text-body-2"},"喵喵喵可以趕快更新嗎",-1),Ct={class:"pa-4"},qt={__name:"index",props:{story:Object,hasCollection:Boolean},setup(P){const I=P,{api:q,apiAuth:S}=Y(),b=F(),W=$(),h=K(),k=m(I.hasCollection),t=m({_id:"",image:"",title:"",mainAuthor:"",category:"",chapterLabels:"",state:!0,totalWordCount:0,collectionNum:0,followNum:0,content:[]}),g=async()=>{var l,r;try{const{data:e}=await q.get("/story/"+W.params.id);t.value._id=e.result._id,t.value.image=e.result.image,t.value.title=e.result.title,t.value.mainAuthor=e.result.mainAuthor,t.value.category=e.result.category,t.value.chapterLabels=e.result.chapterLabels,t.value.state=e.result.state,t.value.totalWordCount=e.result.totalWordCount,t.value.collectionNum=e.result.collectionNum,t.value.followNum=e.result.followNum,t.value.storyId=e.result._id,t.value.createdAt=e.result.createdAt,t.value.extensions=e.result.extensions,t.value.voteTime=e.result.voteTime,t.value.voteStart=e.result.voteStart,t.value.voteEnd=e.result.voteEnd,t.value.chapters=e.result.chapters,t.value.currentChapterWordCount=e.result.currentChapterWordCount,t.value.wordsPerChapter=e.result.wordsPerChapter,t.value.extendWordLimit=e.result.extendWordLimit,Array.isArray(e.result.content)&&e.result.content.length>0?t.value.content=e.result.content:t.value.content=[],document.title="界筆 | "+t.value.title}catch(e){console.log(e),h({text:((r=(l=e==null?void 0:e.response)==null?void 0:l.data)==null?void 0:r.message)||"發生錯誤",snackbarProps:{color:"red"}})}},D=async()=>{if(!b.isLogin){h({text:"請先登入才能收藏",snackbarProps:{color:"red"}});return}try{const l=await S.post("user/addBookmark",{storyId:t.value._id});k.value=l.data.hasCollection,l.data.hasCollection?t.value.collectionNum++:t.value.collectionNum=Math.max(0,t.value.collectionNum-1),h({text:l.data.hasCollection?"收藏故事":"取消收藏",snackbarProps:{color:"green"}})}catch(l){console.error("收藏操作失败",l),h({text:"收藏操作失败",snackbarProps:{color:"red"}})}},O=async()=>{if(b.isLogin)try{const l=await S.get("user/checkBookmark/"+W.params.id);k.value=l.data.hasCollection}catch(l){console.error("檢查收藏狀態失敗",l)}},V=m(null),R=l=>{V.value=V.value===l?null:l},C=m(!1),U=m([]),z=()=>{C.value=!0};return Q(async()=>{await g(),E.on("updateStory",g),b.isLogin&&O()}),X(()=>{E.off("updateStory",g)}),(l,r)=>(u(),w(N,null,[a(et,{style:{padding:"32px"}},{default:o(()=>{var e,p;return[a(_,{class:"mb-4 rounded-lg pa-4"},{default:o(()=>[a(L,{class:"pa-4 align-center"},{default:o(()=>[a(c,{cols:"3"},{default:o(()=>[a(f,{src:t.value.image,alt:"書籍封面","aspect-ratio":"1",style:{"border-radius":"8px","box-shadow":"0 2px 4px rgba(0, 0, 0, 0.2)"}},null,8,["src"])]),_:1}),a(c,{cols:"9"},{default:o(()=>[a(L,null,{default:o(()=>[a(c,{cols:"12"},{default:o(()=>[s("h3",st,n(t.value.title),1)]),_:1}),a(c,{cols:"12"},{default:o(()=>{var i;return[s("p",null,[lt,s("span",rt,n((i=t.value.mainAuthor)==null?void 0:i.username),1)])]}),_:1}),a(c,{cols:"12"},{default:o(()=>[s("p",null,[nt,d(n(t.value.category),1)])]),_:1}),a(c,{cols:"12"},{default:o(()=>[s("p",null,[ct,s("span",ut,n(t.value.state?"完結":"連載"),1)])]),_:1}),a(c,{cols:"12"},{default:o(()=>[s("p",null,[it,s("span",dt,n(t.value.totalWordCount),1)])]),_:1}),a(c,{cols:"12",class:"d-flex"},{default:o(()=>[a(M,{class:"mr-2 text-white",label:"",style:{"background-color":"#ef5350",color:"white"}},{default:o(()=>[d("收藏數 "+n(t.value.collectionNum),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s("div",pt,[(e=t.value.content[0])!=null&&e._id?(u(),v(y,{key:0,class:"mr-4",style:{"background-color":"#2883d3",color:"white"},to:"/stories/"+t.value._id+"/articles/"+((p=t.value.content[0])==null?void 0:p._id)},{default:o(()=>[d("開始閱讀")]),_:1},8,["to"])):j("",!0),a(y,{class:"mr-4",onClick:r[0]||(r[0]=i=>z(U.value)),style:{"background-color":"#2883d3",color:"white"}},{default:o(()=>[d("章節列表")]),_:1}),a(y,{style:{"background-color":"#2883d3",color:"white"},onClick:D,text:k.value?"取消收藏":"收藏故事"},null,8,["text"])]),a(_,{class:"pa-4 rounded-lg",style:{"margin-top":"32px"}},{default:o(()=>{var i,T;return[mt,a(x,{class:"my-2"}),s("p",_t,n((T=(i=t.value.content[0])==null?void 0:i.content)==null?void 0:T[0]),1),(u(!0),w(N,null,B(t.value.chapterLabels,G=>(u(),v(M,{density:"compact",color:"primary",label:!0,class:"mr-2"},{default:o(()=>[d(n(G),1)]),_:2},1024))),256))]}),_:1}),a(_,{class:"pa-4 rounded-lg",style:{"margin-top":"32px"}},{default:o(()=>[vt,a(x,{class:"my-6"}),(u(),v(tt,H({key:t.value._id},t.value,{isExpanded:V.value===t.value._id,onToggle:r[1]||(r[1]=i=>R(t.value._id)),onUpdate:g}),null,16,["isExpanded"]))]),_:1}),a(_,{style:{"margin-top":"32px"}},{default:o(()=>[ht,a(L,{class:""},{default:o(()=>[a(c,null,{default:o(()=>[s("div",gt,[s("div",ft,[a(A,{color:"primary ",class:"me-3",size:"large"},{default:o(()=>[a(f,{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRWAhVMz9jthsapuZL1tkdJks34QlTbXolbmg&s"})]),_:1}),yt,xt]),s("div",bt,[a(A,{color:"secondary ",class:"me-3",size:"large"},{default:o(()=>[a(f,{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTqnRWICFHo49O2OyVoMHrqkQmAevK654iXKw&s"})]),_:1}),kt,Vt]),a(x),s("div",Ct,[a(at,{ref:"textarea",id:"msg",placeholder:"請輸入您的留言或提問",variant:"outlined",width:"600",maxlength:"20",counter:"","auto-grow":""},{prepend:o(()=>[a(A,{color:"primary ",class:"me-1",size:"large"},{default:o(()=>[a(f,{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTyKvt7MWE2LrmiZbNLMYdnwEW-OnNf1sam1g&s"})]),_:1})]),_:1},512),a(y,{variant:"text",class:"rounded-md bg-accent mt-2",density:"comfortable",ripple:!1,id:"submit",style:{"background-color":"#f4b942"}},{default:o(()=>[d("送出")]),_:1})])])]),_:1})]),_:1})]),_:1})]}),_:1}),a(Z,{modelValue:C.value,"onUpdate:modelValue":r[2]||(r[2]=e=>C.value=e),width:"400",scrollable:""},{default:o(()=>[a(_,{"prepend-icon":"mdi-book",title:"章節列表"},{default:o(()=>[a(x),(u(!0),w(N,null,B(t.value.content,(e,p)=>(u(),v(J,{key:p,class:"px-4",style:{"max-height":"400px"}},{default:o(()=>[(u(),v(ot,{key:p,to:"/stories/"+t.value._id+"/articles/"+e._id,class:"chapter-link"},{default:o(()=>[d(n(e.chapterName),1)]),_:2},1032,["to"]))]),_:2},1024))),128))]),_:1})]),_:1},8,["modelValue"])],64))}};export{qt as default};
