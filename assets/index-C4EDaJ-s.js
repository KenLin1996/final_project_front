import{a2 as Nt,O as At,P as i,Q as k,R as e,c as t,V as zt,a0 as o,a3 as q,T as f,Y as p,a4 as R,a5 as G,M as ft,x as T,a6 as mt,o as tt,$ as a,Z as H,S as N,G as F,U as C,W as j,X as z,a7 as et,a8 as at,N as Mt,A as Dt,a9 as Et,aa as K,ab as Bt,_ as Ut,ac as Pt,ad as Ft,ae as Rt,af as Lt,ag as Ot}from"./index-93TIEZcQ.js";import{_ as st}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Wt}from"./VChip-Bu1cUmx9.js";import{c as Ht,a as ct,u as qt,b as ut}from"./vee-validate.esm-PX7IY5fs.js";import{V as Gt}from"./VMenu-CFI8FnfX.js";import{V as _t,a as ht,b as gt}from"./VList-BHt2qzze.js";import{V as Yt,a as Qt,b as it,c as Xt}from"./VExpansionPanels-DMMc1HVf.js";import{V as $,a as u}from"./VRow-KJEewkAt.js";import{V as Zt}from"./VForm-BEUFsBQW.js";import{V as Jt}from"./VTextarea-BZ-uq2C-.js";import{V as U}from"./VContainer-z1ruqh2u.js";import{V as P}from"./VDivider-BIvi382p.js";import"./VSlideGroup-DTnptBId.js";const Kt={class:"d-flex justify-space-between align-center"},te={__name:"BookCard",props:["_id","image","title","category","mainAuthor","content"],setup(s){const m=Nt(),n=l=>{m.push(l)};return(l,h)=>{const y=At("router-link");return i(),k(G,{class:"pa-3 customMargin",width:"220"},{default:e(()=>[t(y,{to:"/stories/"+s._id},{default:e(()=>[t(zt,{class:"cursor-pointer",height:"150px",src:s.image,cover:""},null,8,["src"])]),_:1},8,["to"]),o("div",Kt,[t(q,{class:"px-0 py-1 text-subtitle-1 cursor-pointer",onClick:h[0]||(h[0]=x=>n("/123"))},{default:e(()=>[f(p(s.title),1)]),_:1}),t(Wt,{density:"compact",color:"primary",label:"",style:{"font-size":"12px",padding:"2px 6px"}},{default:e(()=>[f(p(s.category),1)]),_:1})]),t(R,{class:"pa-0 cursor-pointer",style:{"font-size":"12px",color:"#4e9194"},onClick:h[1]||(h[1]=x=>n("/1234"))},{default:e(()=>{var x;return[f(p((x=s.mainAuthor)==null?void 0:x.username),1)]}),_:1}),t(R,{class:"pa-0"},{default:e(()=>[f(p(s.content[0].content[0]),1)]),_:1})]),_:1})}}},dt=st(te,[["__scopeId","data-v-f2bd186d"]]);function ee(s){return{all:s=s||new Map,on:function(m,n){var l=s.get(m);l?l.push(n):s.set(m,[n])},off:function(m,n){var l=s.get(m);l&&(n?l.splice(l.indexOf(n)>>>0,1):s.set(m,[]))},emit:function(m,n){var l=s.get(m);l&&l.slice().map(function(h){h(n)}),(l=s.get("*"))&&l.slice().map(function(h){h(m,n)})}}}const vt=ee(),ae={class:"title-row"},se={class:"title-text"},oe={class:"card-title my-1"},le={class:"vote-section"},ne={class:"vote-count text-body-2"},re={__name:"VoteItem",props:["content","chapterName","author","voteCount","storyId","extensionId","voteStatus"],setup(s){const{apiAuth:m}=at(),n=ft(),l=T([{title:"檢舉"},{title:"刪除"}]),h=T(!1),y=s,{content:x,chapterName:d,author:b,voteStatus:V,voteCount:I,storyId:Y,extensionId:Q}=mt(y),O=n.userId,M=tt(()=>I.value.includes(O)),D=async A=>{try{const _=await m.patch(`/story/${Y.value}/${Q.value}`,{voteCountChange:A});console.log(_.data.message),_.data.hasVotedInOtherExtension||(h.value=!0),vt.emit("updateStory")}catch(_){console.log(_),console.error("Error updating vote count:",_)}};return(A,_)=>(i(),k(G,{class:"w-100 px-6 py-2 rounded-lg",style:{border:"1px solid #48a9a6",margin:"16px 0px"}},{default:e(()=>[t(q,{class:"pa-0"},{default:e(()=>{var w;return[o("div",ae,[o("div",se,[o("h1",oe,p((w=a(b))==null?void 0:w.username),1)]),o("div",le,[t(H,{class:"vote-icon",size:"20"},{default:e(()=>[f("mdi-vote")]),_:1}),o("span",ne,p(s.voteCount.length),1),t(Gt,{location:"end"},{activator:e(({props:E})=>[t(N,F({icon:""},E,{class:"menu-btn",style:{width:"30px",height:"30px",padding:"auto"},variant:"plain"}),{default:e(()=>[t(H,{size:"20"},{default:e(()=>[f("mdi-dots-vertical")]),_:1})]),_:2},1040)]),default:e(()=>[t(_t,{class:"pa-0"},{default:e(()=>[(i(!0),C(j,null,z(l.value,(E,X)=>(i(),k(ht,{key:X,class:""},{default:e(()=>[t(gt,null,{default:e(()=>[f(p(E.title),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]}),_:1}),t(R,{class:"pa-0 mx-7 py-1"},{default:e(()=>{var w;return[f(p((w=a(x))==null?void 0:w[0].latestContent),1)]}),_:1}),t(et,{class:"d-flex justify-end"},{default:e(()=>[t(N,{disabled:a(M)||a(V).hasVoted,style:{"background-color":"#f24e1e",color:"white"},onClick:_[0]||(_[0]=w=>D(1))},{default:e(()=>[f("投票")]),_:1},8,["disabled"]),t(N,{disabled:!a(M)||a(V).hasVoted&&!a(V).voteThis,style:{"background-color":"#f4b942",color:"black","margin-right":"24px"},onClick:_[1]||(_[1]=w=>D(-1))},{default:e(()=>[f("取消")]),_:1},8,["disabled"])]),_:1})]),_:1}))}},ce=st(re,[["__scopeId","data-v-3d2a0771"]]),L=s=>(Lt("data-v-66e46c73"),s=s(),Ot(),s),ue={class:"text--muted"},ie={class:"font-weight-black",style:{"font-size":"16px","margin-right":"4px"}},de=L(()=>o("br",null,null,-1)),pe={key:0,class:"text--danger my-2 d-inline-block font-weight-black",style:{"font-size":"12px"}},fe=L(()=>o("br",null,null,-1)),me={style:{color:"#4e9194","margin-right":"10px","font-size":"14px"}},_e=L(()=>o("br",null,null,-1)),he={key:0,class:"my-2 d-inline-block",style:{color:"black","margin-right":"10px"}},ge=L(()=>o("br",null,null,-1)),ve={style:{color:"black","margin-right":"10px"}},xe=L(()=>o("h1",null,"故事投票",-1)),ye={__name:"StoryItem",props:["category","title","chapterName","mainAuthor","content","createdAt","extensions","_id","voteTime","voteStart","voteEnd"],emits:["update"],setup(s,{emit:m}){const l=ft().userId,h=m,{apiAuth:y}=at(),x=T("");let d=0;const b=Mt(),V=T(10),I=T(50),Y=Ht({newChapterName:ct().required("章節名稱必填").min(1).max(60),newChapterContent:ct().required("故事內容必填").min(V.value,`故事內容不能少於 ${V.value} 字`).max(I.value,`故事內容不能超過 ${I.value} 字`)}),{handleSubmit:Q,isSubmitting:O}=qt({validationSchema:Y,initialValues:{newChapterContent:""}}),M=ut("newChapterName"),D=ut("newChapterContent"),A=T(!1),_=T(!1),w=s,{category:E,title:X,chapterName:xt,mainAuthor:yt,content:W,createdAt:bt,_id:Z}=w,{extensions:S,voteTime:Ie,voteStart:Se,voteEnd:ot}=mt(w),Vt=()=>{A.value=!A.value},wt=tt(()=>A.value?"mdi-heart":"mdi-heart-outline"),Ct=async()=>{try{const{data:g}=await api.get("/story");stories.value.splice(0,stories.value.length,...g.result.data)}catch(g){console.log(g)}},kt=()=>{_.value=!0},$t=tt(()=>[g=>g.length>=V.value&&g.length<=I.value||`內容字數需在 ${V.value} 至 ${I.value} 字之間`]),It=()=>{const g=Date.now(),r=new Date(ot.value).getTime()-g;if(r<=0){clearInterval(d),x.value="投票已結束";return}const c=Math.floor(r/1e3),J=Math.floor(c/(24*3600)),lt=Math.floor(c%(24*3600)/3600),nt=Math.floor(c%3600/60),rt=c%60,B=[];J>0&&B.push(`${J} 天`),lt>0&&B.push(`${lt} 小時`),nt>0&&B.push(`${nt} 分`),rt>0&&B.push(`${rt} 秒`),x.value=B.join(" ")},St=()=>{d=setInterval(()=>{It()},1e3)};Dt(()=>{ot&&St()});const jt=Q(async g=>{var v,r;try{console.log(Z),await y.post(`/story/${Z}`,{chapterName:g.newChapterName,content:g.newChapterContent}),b({text:"延伸內容提交成功",snackbarProps:{color:"green"}}),_.value=!1,h("update")}catch(c){console.log(c),b({text:((r=(v=c==null?void 0:c.response)==null?void 0:v.data)==null?void 0:r.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Et(()=>{clearInterval(d)});const Tt=g=>{let v=!1,r=!1;for(const c of S.value)c.voteCount.indexOf(l)>-1&&(v=!0,c._id===g._id&&(r=!0));return{hasVoted:v,voteThis:r}};return(g,v)=>(i(),k(Xt,{class:"customMb"},{default:e(()=>[t(Yt,null,{default:e(()=>[t(Qt,null,{default:e(()=>[t($,{"no-gutters":""},{default:e(()=>[t(u,{class:"d-flex align-center justify-center text--secondary",style:{"padding-right":"24px"},cols:"1"},{default:e(()=>[o("div",ue,p(a(E)),1)]),_:1}),t(u,{cols:"8",class:"text--secondary"},{default:e(()=>[o("span",ie,p(a(X)),1),de,a(S)&&a(S).length>0?(i(),C("span",pe,"投票倒數計時：")):K("",!0),fe,o("span",null,p(a(xt)),1)]),_:1}),t(u,{cols:"3",class:"text-right",style:{color:"#4e9194"}},{default:e(()=>{var r;return[o("span",me,p((r=a(yt))==null?void 0:r.username),1),_e,a(S)&&a(S).length>0?(i(),C("span",he,p(x.value),1)):K("",!0),ge,o("span",ve,p(new Date(a(bt)).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})),1)]}),_:1})]),_:1})]),_:1}),t(it,null,{default:e(()=>[t($,{style:{padding:"12px"}},{default:e(()=>[t(u,{cols:"12",class:"mt-1 pa-0",style:{"font-size":"8px"}},{default:e(()=>[o("h1",null,p(a(W)[0].latestContent?"最新內容":"開始故事"),1)]),_:1}),t(u,{cols:"12"},{default:e(()=>[t($,null,{default:e(()=>[t(u,{cols:"1",class:"d-flex align-center justify-center pa-0"},{default:e(()=>[t(N,{text:"",ripple:!1,variant:"text",class:Bt(["heart-button pa-0",{filled:A.value}]),onClick:Vt},{default:e(()=>[t(H,null,{default:e(()=>[f(p(wt.value),1)]),_:1})]),_:1},8,["class"])]),_:1}),t(u,{cols:"11",class:"pl-0"},{default:e(()=>{var r;return[o("p",null,p(a(W)[0].latestContent?a(W)[0].latestContent:(r=a(W)[0])==null?void 0:r.content[0]),1),t(et,null,{default:e(()=>[t(Ut),t(N,{color:"secondary",variant:"outlined",onClick:kt},{default:e(()=>[f(" 延續故事 ")]),_:1})]),_:1}),t(Pt,{modelValue:_.value,"onUpdate:modelValue":v[2]||(v[2]=c=>_.value=c),"max-width":"500"},{default:e(()=>[t(Zt,{onSubmit:Ft(a(jt),["prevent"]),disabled:a(O)},{default:e(()=>[t(G,null,{default:e(()=>[t(q,{class:"text-center",style:{"background-color":"#97d8c4"}},{default:e(()=>[f("延續故事")]),_:1}),t(R,{class:"py-4 pb-0"},{default:e(()=>[t(Rt,{modelValue:a(M).value.value,"onUpdate:modelValue":v[0]||(v[0]=c=>a(M).value.value=c),class:"mb-4",label:"輸入章節名稱","hide-details":"",minlength:1,maxlength:60},null,8,["modelValue"]),t(Jt,{modelValue:a(D).value.value,"onUpdate:modelValue":v[1]||(v[1]=c=>a(D).value.value=c),label:`故事內容（字數：${V.value} - ${I.value} 字`,rows:"10",minlength:`${V.value}`,maxlength:`${I.value}`,counter:"",rules:$t.value,style:{"margin-bottom":"8px"}},null,8,["modelValue","label","minlength","maxlength","rules"])]),_:1}),t(et,{class:"justify-center align-start py-0"},{default:e(()=>[t(N,{style:{"background-color":"#4e9194",color:"#000000"},type:"submit",loading:a(O)},{default:e(()=>[f("發布")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(S)&&a(S).length>0?(i(),k(it,{key:0},{default:e(()=>[t(u,{cols:"12",class:"mt-1 mb-3 pa-0",style:{"font-size":"8px"}},{default:e(()=>[xe]),_:1}),(i(!0),C(j,null,z(a(S).slice(0,5),(r,c)=>(i(),k(ce,{key:c,storyId:a(Z),extensionId:r._id,content:r.content,chapterName:r.chapterName,author:r.author,voteCount:r.voteCount,voteStatus:Tt(r),onUpdate:Ct},null,8,["storyId","extensionId","content","chapterName","author","voteCount","voteStatus"]))),128))]),_:1})):K("",!0)]),_:1})]),_:1}))}},pt=st(ye,[["__scopeId","data-v-66e46c73"]]),be={class:"pa-0 px-4"},Ve=o("h2",null,"追蹤故事",-1),we=o("h2",null,"熱門故事",-1),Ce=o("h2",null,"最新故事",-1),ke=o("h2",null,"完結故事",-1),$e=o("h2",null,"創作資源區",-1),Le={__name:"index",setup(s){const{api:m}=at(),n=T([]),l=async()=>{try{const{data:y}=await m.get("/story");n.value.splice(0,n.value.length,...y.result.data)}catch(y){console.log(y)}},h=[{to:"/articleArea",icon:"mdi-lightbulb-on-outline",title:"創作指引",color:"#F9A825"}];return l(),vt.on("updateStory",l),(y,x)=>(i(),C(j,null,[t($,null,{default:e(()=>[t(u,{cols:"12"},{default:e(()=>[t(G,{class:"rounded-0 px-10 py-auto",height:"200px",color:"surface-variant",image:"https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=2948&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",cover:"",elevation:"5"},{default:e(()=>[t(u,null,{default:e(()=>[t(q,{class:"text-h4 font-weight-bold"},{default:e(()=>[f(" 歡迎來到界筆！ ")]),_:1}),t(R,{class:"font-weight-bold pa-0 py-2 px-4 mb-2",style:{"font-size":"24px","letter-spacing":"12px"}},{default:e(()=>[f(" 探索和創作無限可能的故事 ")]),_:1}),o("div",be,[t(N,{class:"font-weight-black mr-3 px-4",variant:"elevated",color:"#CCB78E",to:"/createStory"},{default:e(()=>[f(" 立即創作 ")]),_:1}),t(N,{class:"font-weight-black px-4",outlined:"",border:"",variant:"elevated",style:{color:"#ccb78e",border:"1px solid #ccb78e","background-color":"rgba(0, 0, 0, 0.47)"},to:"/category"},{default:e(()=>[f(" 探索故事 ")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t($,{class:"justify-space-between"},{default:e(()=>[t(u,{cols:"12",class:"pb-0"},{default:e(()=>[Ve]),_:1}),t(P,{class:"mb-3"}),t(u,{cols:"12",class:"d-flex flex-column justify-space-between"},{default:e(()=>[(i(!0),C(j,null,z(n.value,(d,b)=>(i(),k(pt,F({key:b,ref_for:!0},d,{onUpdate:l}),null,16))),128))]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t($,{class:"justify-space-between"},{default:e(()=>[t(u,{cols:"12",class:"pb-0"},{default:e(()=>[we]),_:1}),t(P,{class:"mb-3"}),t(u,{cols:"12",class:"d-flex flex-row justify-start"},{default:e(()=>[(i(!0),C(j,null,z(n.value,d=>(i(),k(dt,F({key:d._id,ref_for:!0},d),null,16))),128))]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t($,{class:"justify-space-between"},{default:e(()=>[t(u,{cols:"12",class:"pb-0"},{default:e(()=>[Ce]),_:1}),t(P,{class:"mb-3"}),t(u,{cols:"12",class:"d-flex flex-column justify-space-between"},{default:e(()=>[(i(!0),C(j,null,z(n.value,(d,b)=>(i(),k(pt,F({key:b,ref_for:!0},d,{onUpdate:l}),null,16))),128))]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t($,{class:"justify-space-between"},{default:e(()=>[t(u,{cols:"12",class:"pb-0"},{default:e(()=>[ke]),_:1}),t(P,{class:"mb-3"}),t(u,{cols:"12",class:"d-flex flex-row justify-space-between"},{default:e(()=>[(i(!0),C(j,null,z(n.value,d=>(i(),k(dt,F({key:d._id,ref_for:!0},d),null,16))),128))]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t($,{class:"justify-space-between"},{default:e(()=>[t(u,{cols:"12",class:"pb-0"},{default:e(()=>[$e]),_:1}),t(P,{class:"mb-3"}),t(u,{cols:"12",class:"d-flex flex-row justify-space-between py-0"},{default:e(()=>[t(_t,{class:"d-flex justify-space-between w-100 py-0",style:{"background-color":"transparent"}},{default:e(()=>[(i(),C(j,null,z(h,(d,b)=>t(ht,{key:b,to:d.to,link:""},{prepend:e(()=>[t(H,{size:"80",color:d.color},{default:e(()=>[f(p(d.icon),1)]),_:2},1032,["color"])]),default:e(()=>[t(gt,{style:{"font-size":"20px","font-weight":"bold"},textContent:p(d.title)},null,8,["textContent"])]),_:2},1032,["to"])),64))]),_:1})]),_:1})]),_:1})]),_:1})],64))}};export{Le as default};
