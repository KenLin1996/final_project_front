import{M as q,N as M,x as b,P as p,Q as x,R as s,c as t,V as d,a0 as a,Y as r,T as n,a5 as h,S as _,U as P,X as R,W as z,am as g,a8 as O,b5 as S}from"./index-CyFtjYzH.js";import{V as E}from"./VContainer-CruJ4dR-.js";import{V as f,a as l}from"./VRow-Crg-VkpT.js";import{V}from"./VChip-Bcr9yrfW.js";import{V as k}from"./VDivider-SsS47DEs.js";import{V as F}from"./VTextarea-BE4FnKXl.js";import"./VSlideGroup-1jC5AXCy.js";const G={class:"blue--text text-h5"},I=a("strong",null,"作者：",-1),K={class:"blue--text"},Q=a("strong",null,"類別：",-1),X=a("strong",null,"狀態：",-1),j={class:"orange--text"},D=a("strong",null,"總字數：",-1),H={class:"grey--text"},U={class:"my-2"},Y=a("h3",{class:""},"起始故事",-1),Z={class:"py-4"},J=a("h3",{class:"pa-4",style:{"background-color":"rgb(146 224 227)"}},"留言區",-1),$={class:""},tt={class:"pa-4"},et=a("span",null,"貓界阿宅",-1),st=a("p",{class:"ml-13 text-body-2"},"這是本喵看過最好看的喵喵喵喵書",-1),at={class:"pa-4"},ot=a("span",null,"黑嚕嚕咕嚕嚕",-1),lt=a("p",{class:"ml-13 text-body-2"},"喵喵喵可以趕快更新嗎",-1),ct={class:"pa-4"},ht={__name:"index",props:{story:Object,hasCollection:Boolean},setup(C){const N=C,{api:A,apiAuth:w}=O(),L=q(),W=S(),i=M(),y=b(N.hasCollection),e=b({_id:"",image:"",title:"",mainAuthor:"",category:"",chapterLabels:"",state:!0,totalWordCount:0,collectionNum:0,followNum:0,content:[]});(async()=>{var c,m;try{const{data:o}=await A.get("/story/"+W.params.id);e.value._id=o.result._id,e.value.image=o.result.image,e.value.title=o.result.title,e.value.mainAuthor=o.result.mainAuthor,e.value.category=o.result.category,e.value.chapterLabels=o.result.chapterLabels,e.value.state=o.result.state,e.value.totalWordCount=o.result.totalWordCount,e.value.collectionNum=o.result.collectionNum,e.value.followNum=o.result.followNum,Array.isArray(o.result.content)&&o.result.content.length>0?e.value.content=o.result.content:e.value.content="內容不存在",document.title="界筆 | "+e.value.title}catch(o){console.log(data.result),console.log(o),i({text:((m=(c=o==null?void 0:o.response)==null?void 0:c.data)==null?void 0:m.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const B=async()=>{if(!L.isLogin){i({text:"請先登入才能收藏",snackbarProps:{color:"red"}});return}try{const c=await w.post("user/addBookmark",{storyId:e.value._id});y.value=c.data.hasCollection,i({text:c.data.hasCollection?"收藏故事":"取消收藏",snackbarProps:{color:"accent"}})}catch(c){console.error("收藏操作失败",c),i({text:"收藏操作失败",snackbarProps:{color:"red"}})}};return(c,m)=>(p(),x(E,{style:{padding:"32px"}},{default:s(()=>{var o;return[t(h,{class:"mb-4"},{default:s(()=>[t(f,{class:"pa-4 align-center"},{default:s(()=>[t(l,{cols:"3"},{default:s(()=>[t(d,{src:e.value.image,alt:"書籍封面","aspect-ratio":"1"},null,8,["src"])]),_:1}),t(l,{cols:"9"},{default:s(()=>[t(f,null,{default:s(()=>[t(l,{cols:"12"},{default:s(()=>[a("h3",G,r(e.value.title),1)]),_:1}),t(l,{cols:"12"},{default:s(()=>{var u;return[a("p",null,[I,a("span",K,r((u=e.value.mainAuthor)==null?void 0:u.username),1)])]}),_:1}),t(l,{cols:"12"},{default:s(()=>[a("p",null,[Q,n(r(e.value.category),1)])]),_:1}),t(l,{cols:"12"},{default:s(()=>[a("p",null,[X,a("span",j,r(e.value.state?"完結":"連載"),1)])]),_:1}),t(l,{cols:"12"},{default:s(()=>[a("p",null,[D,a("span",H,r(e.value.totalWordCount),1)])]),_:1}),t(l,{cols:"12",class:"d-flex"},{default:s(()=>[t(V,{class:"mr-2 grey--text",label:""},{default:s(()=>[n("收藏數 "+r(e.value.collectionNum),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a("div",U,[t(_,{class:"mr-4",style:{"background-color":"#2883d3",color:"white"},to:"/stories/"+e.value._id+"/articles/"+((o=e.value.content[0])==null?void 0:o._id)},{default:s(()=>[n("開始閱讀")]),_:1},8,["to"]),t(_,{class:"mr-4",style:{"background-color":"#2883d3",color:"white"}},{default:s(()=>[n("章節列表")]),_:1}),t(_,{style:{"background-color":"#2883d3",color:"white"},onClick:B,text:y.value?"取消收藏":"收藏故事"},null,8,["text"])]),t(h,{class:"pa-4",style:{"margin-top":"32px"}},{default:s(()=>{var u,v;return[Y,t(k,{class:"my-2"}),a("p",Z,r((v=(u=e.value.content[0])==null?void 0:u.content)==null?void 0:v[0]),1),(p(!0),P(z,null,R(e.value.chapterLabels,T=>(p(),x(V,{density:"compact",color:"primary",label:"true",class:"mr-2"},{default:s(()=>[n(r(T),1)]),_:2},1024))),256))]}),_:1}),t(h,{style:{"margin-top":"32px"}},{default:s(()=>[J,t(f,{class:""},{default:s(()=>[t(l,null,{default:s(()=>[a("div",$,[a("div",tt,[t(g,{color:"primary ",class:"me-3",size:"large"},{default:s(()=>[t(d,{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRWAhVMz9jthsapuZL1tkdJks34QlTbXolbmg&s"})]),_:1}),et,st]),a("div",at,[t(g,{color:"secondary ",class:"me-3",size:"large"},{default:s(()=>[t(d,{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTqnRWICFHo49O2OyVoMHrqkQmAevK654iXKw&s"})]),_:1}),ot,lt]),t(k),a("div",ct,[t(F,{ref:"textarea",id:"msg",placeholder:"請輸入您的留言或提問",variant:"outlined",width:"600",maxlength:"20",counter:""},{prepend:s(()=>[t(g,{color:"primary ",class:"me-1",size:"large"},{default:s(()=>[t(d,{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTyKvt7MWE2LrmiZbNLMYdnwEW-OnNf1sam1g&s"})]),_:1})]),_:1},512),t(_,{variant:"text",class:"rounded-md bg-accent mt-2",density:"comfortable",ripple:!1,id:"submit",style:{"background-color":"#f4b942"}},{default:s(()=>[n("送出")]),_:1})])])]),_:1})]),_:1})]),_:1})]}),_:1}))}};export{ht as default};
