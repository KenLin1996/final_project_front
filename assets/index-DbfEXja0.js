import{a2 as xe,O as ge,P as u,Q as v,R as t,c as e,V as ye,a0 as l,a3 as H,T as i,Y as p,a4 as D,a5 as O,M as ve,x as $,A as be,Z as W,S as j,G as M,U as C,W as S,X as A,a6 as Q,a7 as X,N as Ve,a8 as we,o as J,a9 as Ce,$ as r,aa as K,ab as ke,_ as $e,ac as Ie,ad as Se,ae as je,af as Ne,ag as Ae}from"./index-BKIc8ZCl.js";import{_ as Z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as ze}from"./VChip-JIDC1TPP.js";import{c as Te,a as ee,u as Ee,b as te}from"./vee-validate.esm-Bk5wUjqT.js";import{V as Be}from"./VMenu-blMy1bmu.js";import{V as oe,a as ne,b as re}from"./VList-Dj2xexw6.js";import{V as Me,a as De,b as ae,c as Ue}from"./VExpansionPanels-aQ0zxHPa.js";import{V as k,a as c}from"./VRow-CkmJdb3y.js";import{V as Pe}from"./VForm-CwTiuDHW.js";import{V as Fe}from"./VTextarea-CBf4alHr.js";import{V as E}from"./VContainer-DbCyThGi.js";import{V as B}from"./VDivider-D-0r2qJ4.js";import"./VSlideGroup-DT0HzpWE.js";const Le={class:"d-flex justify-space-between align-center"},Re={__name:"BookCard",props:["_id","image","title","category","mainAuthor","content"],setup(a){const f=xe(),o=s=>{f.push(s)};return(s,d)=>{const x=ge("router-link");return u(),v(O,{class:"pa-3 customMargin",width:"220"},{default:t(()=>[e(x,{to:"/stories/"+a._id},{default:t(()=>[e(ye,{class:"cursor-pointer",height:"150px",src:a.image,cover:""},null,8,["src"])]),_:1},8,["to"]),l("div",Le,[e(H,{class:"px-0 py-1 text-subtitle-1 cursor-pointer",onClick:d[0]||(d[0]=_=>o("/123"))},{default:t(()=>[i(p(a.title),1)]),_:1}),e(ze,{density:"compact",color:"primary",label:"",style:{"font-size":"12px",padding:"2px 6px"}},{default:t(()=>[i(p(a.category),1)]),_:1})]),e(D,{class:"pa-0 cursor-pointer",style:{"font-size":"12px",color:"#4e9194"},onClick:d[1]||(d[1]=_=>o("/1234"))},{default:t(()=>{var _;return[i(p((_=a.mainAuthor)==null?void 0:_.username),1)]}),_:1}),e(D,{class:"pa-0"},{default:t(()=>[i(p(a.content[0].content[0]),1)]),_:1})]),_:1})}}},le=Z(Re,[["__scopeId","data-v-f2bd186d"]]);function We(a){return{all:a=a||new Map,on:function(f,o){var s=a.get(f);s?s.push(o):a.set(f,[o])},off:function(f,o){var s=a.get(f);s&&(o?s.splice(s.indexOf(o)>>>0,1):a.set(f,[]))},emit:function(f,o){var s=a.get(f);s&&s.slice().map(function(d){d(o)}),(s=a.get("*"))&&s.slice().map(function(d){d(f,o)})}}}const ce=We(),He={class:"title-row"},Oe={class:"title-text"},qe={class:"card-title my-1"},Ge={class:"vote-section"},Ye={class:"vote-count text-body-2"},Qe={__name:"VoteItem",props:["content","chapterName","author","voteCount","storyId","extensionId"],setup(a){const{apiAuth:f}=X(),o=ve(),s=$([{title:"檢舉"},{title:"刪除"}]),d=$(!1),x=$(!1),{content:_,chapterName:n,author:I,voteCount:q,storyId:P,extensionId:F}=a,L=o.userId;be(()=>{q.includes(L)&&(d.value=!0)});const N=async b=>{try{const h=await f.patch(`/story/${P}/${F}`,{voteCountChange:b});console.log(h.data.message),h.data.hasVotedInOtherExtension?b===1?d.value=!0:b===-1&&(d.value=!1):x.value=!0,ce.emit("updateStory")}catch(h){console.log(h),console.error("Error updating vote count:",h)}};return(b,h)=>(u(),v(O,{class:"w-100 px-6 py-2 rounded-lg",style:{border:"1px solid #48a9a6",margin:"16px 0px"}},{default:t(()=>[e(H,{class:"pa-0"},{default:t(()=>{var V;return[l("div",He,[l("div",Oe,[l("h1",qe,p((V=a.author)==null?void 0:V.username),1)]),l("div",Ge,[e(W,{class:"vote-icon",size:"20"},{default:t(()=>[i("mdi-vote")]),_:1}),l("span",Ye,p(a.voteCount.length),1),e(Be,{location:"end"},{activator:t(({props:z})=>[e(j,M({icon:""},z,{class:"menu-btn",style:{width:"30px",height:"30px",padding:"auto"},variant:"plain"}),{default:t(()=>[e(W,{size:"20"},{default:t(()=>[i("mdi-dots-vertical")]),_:1})]),_:2},1040)]),default:t(()=>[e(oe,{class:"pa-0"},{default:t(()=>[(u(!0),C(S,null,A(s.value,(z,G)=>(u(),v(ne,{key:G,class:""},{default:t(()=>[e(re,null,{default:t(()=>[i(p(z.title),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]}),_:1}),e(D,{class:"pa-0 mx-7 py-1"},{default:t(()=>{var V;return[i(p((V=a.content)==null?void 0:V[0].latestContent),1)]}),_:1}),e(Q,{class:"d-flex justify-end"},{default:t(()=>[e(j,{disabled:d.value||x.value,style:{"background-color":"#f24e1e",color:"white"},onClick:h[0]||(h[0]=V=>N(1))},{default:t(()=>[i("投票")]),_:1},8,["disabled"]),e(j,{disabled:!d.value,style:{"background-color":"#f4b942",color:"black","margin-right":"24px"},onClick:h[1]||(h[1]=V=>N(-1))},{default:t(()=>[i("取消")]),_:1},8,["disabled"])]),_:1})]),_:1}))}},Xe=Z(Qe,[["__scopeId","data-v-11c47e6b"]]),U=a=>(Ne("data-v-c5e4c394"),a=a(),Ae(),a),Ze={class:"text--muted"},Je={class:"font-weight-black",style:{"font-size":"16px","margin-right":"4px"}},Ke=U(()=>l("br",null,null,-1)),et={key:0,class:"text--danger my-2 d-inline-block font-weight-black",style:{"font-size":"12px"}},tt=U(()=>l("br",null,null,-1)),at={style:{color:"#4e9194","margin-right":"10px","font-size":"14px"}},lt=U(()=>l("br",null,null,-1)),st=U(()=>l("br",null,null,-1)),ot={style:{color:"black","margin-right":"10px"}},nt=U(()=>l("h1",null,"故事投票",-1)),rt={__name:"StoryItem",props:["category","title","chapterName","mainAuthor","content","createdAt","extensions","_id","voteTime","voteStart","voteEnd"],emits:["update"],setup(a,{emit:f}){const o=f,{apiAuth:s}=X();$("");let d=0;const x=Ve(),_=$(10),n=$(50),I=Te({newChapterName:ee().required("章節名稱必填").min(1).max(60),newChapterContent:ee().required("故事內容必填").min(_.value,`故事內容不能少於 ${_.value} 字`).max(n.value,`故事內容不能超過 ${n.value} 字`)}),{handleSubmit:q,isSubmitting:P}=Ee({validationSchema:I,initialValues:{newChapterContent:""}}),F=te("newChapterName"),L=te("newChapterContent"),N=$(!1),b=$(!1),h=a,{category:V,title:z,chapterName:G,mainAuthor:ue,content:R,createdAt:ie,_id:Y}=h,{extensions:T,voteTime:mt,voteStart:_t,voteEnd:ht}=we(h),de=()=>{N.value=!N.value},pe=J(()=>N.value?"mdi-heart":"mdi-heart-outline"),fe=async()=>{try{const{data:y}=await api.get("/story");stories.value.splice(0,stories.value.length,...y.result.data)}catch(y){console.log(y)}},me=()=>{b.value=!0},_e=J(()=>[y=>y.length>=_.value&&y.length<=n.value||`內容字數需在 ${_.value} 至 ${n.value} 字之間`]),he=q(async y=>{var w,m;try{console.log(Y),await s.post(`/story/${Y}`,{chapterName:y.newChapterName,content:y.newChapterContent}),x({text:"延伸內容提交成功",snackbarProps:{color:"green"}}),b.value=!1,o("update")}catch(g){console.log(g),x({text:((m=(w=g==null?void 0:g.response)==null?void 0:w.data)==null?void 0:m.message)||"發生錯誤",snackbarProps:{color:"red"}})}});return Ce(()=>{clearInterval(d)}),(y,w)=>(u(),v(Ue,{class:"customMb"},{default:t(()=>[e(Me,null,{default:t(()=>[e(De,null,{default:t(()=>[e(k,{"no-gutters":""},{default:t(()=>[e(c,{class:"d-flex align-center justify-center text--secondary",style:{"padding-right":"24px"},cols:"1"},{default:t(()=>[l("div",Ze,p(r(V)),1)]),_:1}),e(c,{cols:"8",class:"text--secondary"},{default:t(()=>[l("span",Je,p(r(z)),1),Ke,r(T)&&r(T).length>0?(u(),C("span",et,"投票倒數計時：")):K("",!0),tt,l("span",null,p(r(G)),1)]),_:1}),e(c,{cols:"3",class:"text-right",style:{color:"#4e9194"}},{default:t(()=>{var m;return[l("span",at,p((m=r(ue))==null?void 0:m.username),1),lt,st,l("span",ot,p(new Date(r(ie)).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})),1)]}),_:1})]),_:1})]),_:1}),e(ae,null,{default:t(()=>[e(k,{style:{padding:"12px"}},{default:t(()=>[e(c,{cols:"12",class:"mt-1 pa-0",style:{"font-size":"8px"}},{default:t(()=>[l("h1",null,p(r(R)[0].latestContent?"最新內容":"開始故事"),1)]),_:1}),e(c,{cols:"12"},{default:t(()=>[e(k,null,{default:t(()=>[e(c,{cols:"1",class:"d-flex align-center justify-center pa-0"},{default:t(()=>[e(j,{text:"",ripple:!1,variant:"text",class:ke(["heart-button pa-0",{filled:N.value}]),onClick:de},{default:t(()=>[e(W,null,{default:t(()=>[i(p(pe.value),1)]),_:1})]),_:1},8,["class"])]),_:1}),e(c,{cols:"11",class:"pl-0"},{default:t(()=>{var m;return[l("p",null,p(r(R)[0].latestContent?r(R)[0].latestContent:(m=r(R)[0])==null?void 0:m.content[0]),1),e(Q,null,{default:t(()=>[e($e),e(j,{color:"secondary",variant:"outlined",onClick:me},{default:t(()=>[i(" 延續故事 ")]),_:1})]),_:1}),e(Ie,{modelValue:b.value,"onUpdate:modelValue":w[2]||(w[2]=g=>b.value=g),"max-width":"500"},{default:t(()=>[e(Pe,{onSubmit:Se(r(he),["prevent"]),disabled:r(P)},{default:t(()=>[e(O,null,{default:t(()=>[e(H,{class:"text-center",style:{"background-color":"#97d8c4"}},{default:t(()=>[i("延續故事")]),_:1}),e(D,{class:"py-4 pb-0"},{default:t(()=>[e(je,{modelValue:r(F).value.value,"onUpdate:modelValue":w[0]||(w[0]=g=>r(F).value.value=g),class:"mb-4",label:"輸入章節名稱","hide-details":"",minlength:1,maxlength:60},null,8,["modelValue"]),e(Fe,{modelValue:r(L).value.value,"onUpdate:modelValue":w[1]||(w[1]=g=>r(L).value.value=g),label:`故事內容（字數：${_.value} - ${n.value} 字`,rows:"10",minlength:`${_.value}`,maxlength:`${n.value}`,counter:"",rules:_e.value,style:{"margin-bottom":"8px"}},null,8,["modelValue","label","minlength","maxlength","rules"])]),_:1}),e(Q,{class:"justify-center align-start py-0"},{default:t(()=>[e(j,{style:{"background-color":"#4e9194",color:"#000000"},type:"submit",loading:r(P)},{default:t(()=>[i("發布")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),r(T)&&r(T).length>0?(u(),v(ae,{key:0},{default:t(()=>[e(c,{cols:"12",class:"mt-1 mb-3 pa-0",style:{"font-size":"8px"}},{default:t(()=>[nt]),_:1}),(u(!0),C(S,null,A(r(T).slice(0,5),(m,g)=>(u(),v(Xe,{key:g,storyId:r(Y),extensionId:m._id,content:m.content,chapterName:m.chapterName,author:m.author,voteCount:m.voteCount,onUpdate:fe},null,8,["storyId","extensionId","content","chapterName","author","voteCount"]))),128))]),_:1})):K("",!0)]),_:1})]),_:1}))}},se=Z(rt,[["__scopeId","data-v-c5e4c394"]]),ct={class:"pa-0 px-4"},ut=l("h2",null,"追蹤故事",-1),it=l("h2",null,"熱門故事",-1),dt=l("h2",null,"最新故事",-1),pt=l("h2",null,"完結故事",-1),ft=l("h2",null,"創作資源區",-1),Nt={__name:"index",setup(a){const{api:f}=X(),o=$([]),s=async()=>{try{const{data:x}=await f.get("/story");o.value.splice(0,o.value.length,...x.result.data)}catch(x){console.log(x)}},d=[{to:"/articleArea",icon:"mdi-lightbulb-on-outline",title:"創作指引",color:"#F9A825"}];return s(),ce.on("updateStory",s),(x,_)=>(u(),C(S,null,[e(k,null,{default:t(()=>[e(c,{cols:"12"},{default:t(()=>[e(O,{class:"rounded-0 px-10 py-auto",height:"200px",color:"surface-variant",image:"https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=2948&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",cover:"",elevation:"5"},{default:t(()=>[e(c,null,{default:t(()=>[e(H,{class:"text-h4 font-weight-bold"},{default:t(()=>[i(" 歡迎來到界筆！ ")]),_:1}),e(D,{class:"font-weight-bold pa-0 py-2 px-4 mb-2",style:{"font-size":"24px","letter-spacing":"12px"}},{default:t(()=>[i(" 探索和創作無限可能的故事 ")]),_:1}),l("div",ct,[e(j,{class:"font-weight-black mr-3 px-4",variant:"elevated",color:"#CCB78E",to:"/createStory"},{default:t(()=>[i(" 立即創作 ")]),_:1}),e(j,{class:"font-weight-black px-4",outlined:"",border:"",variant:"elevated",style:{color:"#ccb78e",border:"1px solid #ccb78e","background-color":"rgba(0, 0, 0, 0.47)"},to:"/category"},{default:t(()=>[i(" 探索故事 ")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),e(E,{style:{padding:"32px"}},{default:t(()=>[e(k,{class:"justify-space-between"},{default:t(()=>[e(c,{cols:"12",class:"pb-0"},{default:t(()=>[ut]),_:1}),e(B,{class:"mb-3"}),e(c,{cols:"12",class:"d-flex flex-column justify-space-between"},{default:t(()=>[(u(!0),C(S,null,A(o.value,(n,I)=>(u(),v(se,M({key:I,ref_for:!0},n,{onUpdate:s}),null,16))),128))]),_:1})]),_:1})]),_:1}),e(E,{style:{padding:"32px"}},{default:t(()=>[e(k,{class:"justify-space-between"},{default:t(()=>[e(c,{cols:"12",class:"pb-0"},{default:t(()=>[it]),_:1}),e(B,{class:"mb-3"}),e(c,{cols:"12",class:"d-flex flex-row justify-start"},{default:t(()=>[(u(!0),C(S,null,A(o.value,n=>(u(),v(le,M({key:n._id,ref_for:!0},n),null,16))),128))]),_:1})]),_:1})]),_:1}),e(E,{style:{padding:"32px"}},{default:t(()=>[e(k,{class:"justify-space-between"},{default:t(()=>[e(c,{cols:"12",class:"pb-0"},{default:t(()=>[dt]),_:1}),e(B,{class:"mb-3"}),e(c,{cols:"12",class:"d-flex flex-column justify-space-between"},{default:t(()=>[(u(!0),C(S,null,A(o.value,(n,I)=>(u(),v(se,M({key:I,ref_for:!0},n,{onUpdate:s}),null,16))),128))]),_:1})]),_:1})]),_:1}),e(E,{style:{padding:"32px"}},{default:t(()=>[e(k,{class:"justify-space-between"},{default:t(()=>[e(c,{cols:"12",class:"pb-0"},{default:t(()=>[pt]),_:1}),e(B,{class:"mb-3"}),e(c,{cols:"12",class:"d-flex flex-row justify-space-between"},{default:t(()=>[(u(!0),C(S,null,A(o.value,n=>(u(),v(le,M({key:n._id,ref_for:!0},n),null,16))),128))]),_:1})]),_:1})]),_:1}),e(E,{style:{padding:"32px"}},{default:t(()=>[e(k,{class:"justify-space-between"},{default:t(()=>[e(c,{cols:"12",class:"pb-0"},{default:t(()=>[ft]),_:1}),e(B,{class:"mb-3"}),e(c,{cols:"12",class:"d-flex flex-row justify-space-between py-0"},{default:t(()=>[e(oe,{class:"d-flex justify-space-between w-100 py-0",style:{"background-color":"transparent"}},{default:t(()=>[(u(),C(S,null,A(d,(n,I)=>e(ne,{key:I,to:n.to,link:""},{prepend:t(()=>[e(W,{size:"80",color:n.color},{default:t(()=>[i(p(n.icon),1)]),_:2},1032,["color"])]),default:t(()=>[e(re,{style:{"font-size":"20px","font-weight":"bold"},textContent:p(n.title)},null,8,["textContent"])]),_:2},1032,["to"])),64))]),_:1})]),_:1})]),_:1})]),_:1})],64))}};export{Nt as default};
