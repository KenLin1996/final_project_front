import{bd as T,N as q,x,Q as V,R as a,P as p,c as t,V as d,a0 as s,Y as o,T as n,a5 as h,S as i,U as R,X as z,W as M,am as g,a7 as O}from"./index-BKIc8ZCl.js";import{V as P}from"./VContainer-DbCyThGi.js";import{V as f,a as c}from"./VRow-CkmJdb3y.js";import{V as y}from"./VChip-JIDC1TPP.js";import{V as k}from"./VDivider-D-0r2qJ4.js";import{V as E}from"./VTextarea-CBf4alHr.js";import"./VSlideGroup-DT0HzpWE.js";const F={class:"blue--text text-h5"},G=s("strong",null,"作者：",-1),I={class:"blue--text"},K=s("strong",null,"類別：",-1),Q=s("strong",null,"狀態：",-1),S={class:"orange--text"},X=s("strong",null,"總字數：",-1),j={class:"grey--text"},D={class:"my-2"},H=s("h3",{class:""},"起始故事",-1),Y={class:"py-4"},Z=s("h3",{class:"pa-4",style:{"background-color":"rgb(146 224 227)"}},"留言區",-1),J={class:""},U={class:"pa-4"},$=s("span",null,"貓界阿宅",-1),tt=s("p",{class:"ml-13 text-body-2"},"這是本喵看過最好看的喵喵喵喵書",-1),et={class:"pa-4"},at=s("span",null,"黑嚕嚕咕嚕嚕",-1),st=s("p",{class:"ml-13 text-body-2"},"喵喵喵可以趕快更新嗎",-1),lt={class:"pa-4"},mt={__name:"index",props:{story:Object,hasCollection:Boolean},setup(N){const C=N,{api:w,apiAuth:A}=O(),W=T(),_=q(),v=x(C.hasCollection),e=x({_id:"",image:"",title:"",mainAuthor:"",category:"",chapterLabels:"",state:!0,totalWordCount:0,collectionNum:0,followNum:0,content:[]});(async()=>{var r,m;try{const{data:l}=await w.get("/story/"+W.params.id);e.value._id=l.result._id,e.value.image=l.result.image,e.value.title=l.result.title,e.value.mainAuthor=l.result.mainAuthor,e.value.category=l.result.category,e.value.chapterLabels=l.result.chapterLabels,e.value.state=l.result.state,e.value.totalWordCount=l.result.totalWordCount,e.value.collectionNum=l.result.collectionNum,e.value.followNum=l.result.followNum,Array.isArray(l.result.content)&&l.result.content.length>0?e.value.content=l.result.content:e.value.content="內容不存在",document.title="界筆 | "+e.value.title}catch(l){console.log(data.result),console.log(l),_({text:((m=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:m.message)||"發生錯誤",snackbarProps:{color:"red"}})}})();const L=async()=>{try{const r=await A.post("user/addBookmark",{storyId:e.value._id});v.value=r.data.hasCollection,_({text:r.data.hasCollection?"收藏故事":"取消收藏",snackbarProps:{color:"accent"}})}catch(r){console.error("收藏操作失败",r),_({text:"收藏操作失败",snackbarProps:{color:"red"}})}};return(r,m)=>(p(),V(P,{style:{padding:"32px"}},{default:a(()=>{var l;return[t(h,{class:"mb-4"},{default:a(()=>[t(f,{class:"pa-4 align-center"},{default:a(()=>[t(c,{cols:"3"},{default:a(()=>[t(d,{src:e.value.image,alt:"書籍封面","aspect-ratio":"1"},null,8,["src"])]),_:1}),t(c,{cols:"9"},{default:a(()=>[t(f,null,{default:a(()=>[t(c,{cols:"12"},{default:a(()=>[s("h3",F,o(e.value.title),1)]),_:1}),t(c,{cols:"12"},{default:a(()=>{var u;return[s("p",null,[G,s("span",I,o((u=e.value.mainAuthor)==null?void 0:u.username),1)])]}),_:1}),t(c,{cols:"12"},{default:a(()=>[s("p",null,[K,n(o(e.value.category),1)])]),_:1}),t(c,{cols:"12"},{default:a(()=>[s("p",null,[Q,s("span",S,o(e.value.state?"完結":"連載"),1)])]),_:1}),t(c,{cols:"12"},{default:a(()=>[s("p",null,[X,s("span",j,o(e.value.totalWordCount),1)])]),_:1}),t(c,{cols:"12",class:"d-flex"},{default:a(()=>[t(y,{class:"mr-2 grey--text",label:""},{default:a(()=>[n("收藏數 "+o(e.value.collectionNum),1)]),_:1}),t(y,{class:"grey--text",label:""},{default:a(()=>[n("追蹤數 "+o(e.value.followNum),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s("div",D,[t(i,{class:"mr-4",style:{"background-color":"#2883d3",color:"white"},to:"/stories/"+e.value._id+"/articles/"+((l=e.value.content[0])==null?void 0:l._id)},{default:a(()=>[n("開始閱讀")]),_:1},8,["to"]),t(i,{class:"mr-4",style:{"background-color":"#2883d3",color:"white"}},{default:a(()=>[n("章節列表")]),_:1}),t(i,{style:{"background-color":"#2883d3",color:"white"},onClick:L,text:v.value?"取消收藏":"收藏故事"},null,8,["text"])]),t(h,{class:"pa-4",style:{"margin-top":"32px"}},{default:a(()=>{var u,b;return[H,t(k,{class:"my-2"}),s("p",Y,o((b=(u=e.value.content[0])==null?void 0:u.content)==null?void 0:b[0]),1),(p(!0),R(M,null,z(e.value.chapterLabels,B=>(p(),V(y,{density:"compact",color:"primary",label:"true",class:"mr-2"},{default:a(()=>[n(o(B),1)]),_:2},1024))),256))]}),_:1}),t(h,{style:{"margin-top":"32px"}},{default:a(()=>[Z,t(f,{class:""},{default:a(()=>[t(c,null,{default:a(()=>[s("div",J,[s("div",U,[t(g,{color:"primary ",class:"me-3",size:"large"},{default:a(()=>[t(d,{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRWAhVMz9jthsapuZL1tkdJks34QlTbXolbmg&s"})]),_:1}),$,tt]),s("div",et,[t(g,{color:"secondary ",class:"me-3",size:"large"},{default:a(()=>[t(d,{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTqnRWICFHo49O2OyVoMHrqkQmAevK654iXKw&s"})]),_:1}),at,st]),t(k),s("div",lt,[t(E,{ref:"textarea",id:"msg",placeholder:"請輸入您的留言或提問",variant:"outlined",width:"600",maxlength:"20",counter:""},{prepend:a(()=>[t(g,{color:"primary ",class:"me-1",size:"large"},{default:a(()=>[t(d,{src:"https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTyKvt7MWE2LrmiZbNLMYdnwEW-OnNf1sam1g&s"})]),_:1})]),_:1},512),t(i,{variant:"text",class:"rounded-md bg-accent mt-2",density:"comfortable",ripple:!1,id:"submit",style:{"background-color":"#f4b942"}},{default:a(()=>[n("送出")]),_:1})])])]),_:1})]),_:1})]),_:1})]}),_:1}))}};export{mt as default};
