import{p as ue,aC as ie,aD as de,g as ce,D as me,aE as fe,aF as ge,o as q,x as _,G as Q,u as pe,aG as J,c as e,aH as ve,M as Ve,A as xe,N as be,P as ye,Q as c,R as m,S as l,ab as _e,a2 as r,_ as f,U as n,a1 as v,aI as V,af as j,a0 as t,T as he,ae as we,a5 as ke,ag as Se,ah as Ce}from"./index-D8Mo-riY.js";import{c as Me,d as K,a as W,e as qe,f as X,u as Ne,b}from"./vee-validate.esm-7QMx_sga.js";import{_ as Te}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Ue}from"./VContainer-D2_Tlp7J.js";import{V as Fe}from"./VDivider-BzHLweN9.js";import{V as g,a as p}from"./VRow-BdRUm_bt.js";import{V as Pe}from"./VTextarea-z-G7oqnu.js";import{V as E,a as Y,b as H}from"./VRadioGroup-BNFym9We.js";import{V as ze}from"./VForm-Cgkhuj3f.js";import"./VList-CF621bau.js";import"./VMenu-DNuh_dXC.js";import"./VSelectionControl-wDnnDPQ6.js";import"./VChip-CuIev6Op.js";import"./VSlideGroup-DZptSWD8.js";const Le=ue({id:String,text:String,...ie(de({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),Re=ce()({name:"VTooltip",props:Le(),emits:{"update:modelValue":o=>!0},setup(o,U){let{slots:h}=U;const N=me(o,"modelValue"),{scopeId:I}=fe(),F=ge(),T=q(()=>o.id||`v-tooltip-${F}`),x=_(),P=q(()=>o.location.split(" ").length>1?o.location:o.location+" center"),d=q(()=>o.origin==="auto"||o.origin==="overlap"||o.origin.split(" ").length>1||o.location.split(" ").length>1?o.origin:o.origin+" center"),O=q(()=>o.transition?o.transition:N.value?"scale-transition":"fade-transition"),A=q(()=>Q({"aria-describedby":T.value},o.activatorProps));return pe(()=>{const z=J.filterProps(o);return e(J,Q({ref:x,class:["v-tooltip",o.class],style:o.style,id:T.value},z,{modelValue:N.value,"onUpdate:modelValue":w=>N.value=w,transition:O.value,absolute:!0,location:P.value,origin:d.value,persistent:!0,role:"tooltip",activatorProps:A.value,_disableGlobalStack:!0},I),{activator:h.activator,default:function(){var S;for(var w=arguments.length,k=new Array(w),y=0;y<w;y++)k[y]=arguments[y];return((S=h.default)==null?void 0:S.call(h,...k))??o.text}})}),ve({},x)}}),Z=o=>(Se("data-v-ccd0c518"),o=o(),Ce(),o),We=Z(()=>r("h2",null,"創作新故事",-1)),Ie={class:"me-2"},Oe={class:"d-flex align-center"},Ae=Z(()=>r("div",{class:"tooltip-content"},[r("p",null,[r("strong",null,"詩")]),r("ul",null,[r("li",null,"短詩：50字以内"),r("li",null,"長詩：數百到數千字")]),r("p",null,[r("strong",null,"小說")]),r("ul",null,[r("li",null,"短篇小說：1,000到20,000字（通常3,000到7,500字之間）"),r("li",null,"中篇小說：20,000到50,000字"),r("li",null,"長篇小說：超過50,000字（通常80,000到120,000字之間）")]),r("p",null,[r("strong",null,"短品（散文、隨筆等）")]),r("ul",null,[r("li",null,"短篇散文：500到2,000字"),r("li",null,"隨筆：1,000到5,000字")])],-1)),Be={class:"d-flex align-center"},$e={class:"d-flex align-center"},De={__name:"createStory",setup(o){const U=ke(),h=Ve(),N=()=>{h.isLogin?U.push("/createStory"):U.push("/login")};xe(()=>{N()});const{apiAuth:I}=_e(),F=be(),T=_(null),x=_([]),P=_([]),d=["totalWordCount","title","chapterName","content","category","chapterLabels","state","show","fileRecords"],O=Me({totalWordCount:K().required("文章總字數必填").typeError("文章總字數必須是數字").positive("文章總字數必須是正數").integer("文章總字數必須是整數").min(1,"文章總字數不能為0"),title:W().required("故事名稱必填"),chapterName:W().required("章節名稱必填"),content:W().required("內容必填").test("max-length",function(){return`不能超過 ${M.value} 個字`},function(u){return u.length<=M.value}),category:W().required("作品分類必填"),chapterLabels:qe().min(1,"至少需要選擇一個標籤").required("作品標籤必填"),state:X().required("狀態必填"),show:X().required("顯示方式必填"),voteTime:K().required("投票時間必填").min(10)}),{handleSubmit:A,isSubmitting:z,resetForm:w}=Ne({validationSchema:O,initialValues:{totalWordCount:0,title:"",chapterName:"",content:"",voteTime:1e3*5*60,category:"",chapterLabels:[],state:!1,show:!0}}),k=b("title"),y=b("chapterName"),S=b("voteTime"),B=b("category"),$=b("chapterLabels"),D=b("state"),G=b("show"),L=b("totalWordCount"),C=b("content"),M=q(()=>{const u=Number(L.value.value);return Math.max(1,Math.floor(u/10))}),ee=()=>{C.value.value.length>M.value&&(C.value.value=C.value.value.slice(0,M.value))},le=_(["文藝評論","商業理財","藝術設計","人文科普","心靈養生","生活風格","親子共享","傳記/文學史","羅曼史","校園愛情","武俠仙俠","歷史","驚悚推理","奇幻","恐怖靈異","影視","軍事戰爭/災難冒險","溫馨勵志/成長療癒","幽默/諷喻","同志","漫畫","同人","都市","玄幻","科幻","網遊","都會愛情","古代愛情","百合","其他"]),te=_(["不限","爽文","心情抒發","療癒","青梅竹馬","戰鬥","異界","戀愛","日常","校園","搞笑","後宮","異能","妖怪","妹控","節操","二創","百合","虐心","甜文","悲劇","喜劇","輕鬆","暗黑","清水","穿越","重生","靈異神怪","異國","冒險","女性向","男性向","輕小說","同志","恐怖"]),ae=_([{title:"10 秒",value:1e3*10},{title:"5 分鐘",value:1e3*5*60},{title:"10 分鐘",value:1e3*10*60},{title:"30 分鐘",value:1e3*30*60},{title:"1 小時",value:1e3*60*60},{title:"2 小時",value:1e3*2*60*60},{title:"4 小時",value:1e3*4*60*60},{title:"8 小時",value:1e3*8*60*60},{title:"12 小時",value:1e3*12*60*60},{title:"24 小時",value:1e3*24*60*60},{title:"36 小時",value:1e3*36*60*60}]),se=()=>{w(),T.value.deleteFileRecord()},oe=A(async u=>{var s,R,a;if(console.log("提交函數被調用"),console.log("提交的值（原始）：",u),console.log("驗證通過"),u.totalWordCount=Number(u.totalWordCount),console.log("提交的值（處理後）：",u),(s=x.value[0])!=null&&s.error){console.log("文件錯誤：",x.value[0].error);return}console.log("文件檢查通過");try{const i=new FormData;i.append("totalWordCount",u.totalWordCount),i.append("title",u.title),i.append("chapterName",u.chapterName),i.append("content",u.content),i.append("voteTime",u.voteTime),i.append("category",u.category);for(const ne of u.chapterLabels)i.append("chapterLabels",ne);i.append("state",u.state),i.append("show",u.show),x.value.length>0&&i.append("image",x.value[0].file),console.log("FormData 已創建"),console.log("FormData 內容：",Object.fromEntries(i));const re=await I.post("/story",i);console.log("API 響應：",re.data),F({text:"新增成功",snackbarProps:{color:"green"}}),se()}catch(i){console.error("提交表單時發生錯誤:",i),F({text:((a=(R=i==null?void 0:i.response)==null?void 0:R.data)==null?void 0:a.message)||"發生錯誤",snackbarProps:{color:"red"}})}});return(u,s)=>{const R=ye("vue-file-agent");return c(),m(Ue,{style:{padding:"32px"}},{default:l(()=>[We,e(Fe,{class:"mb-5"}),e(ze,{onSubmit:we(t(oe),["prevent"]),disabled:t(z),style:{padding:"10px 20px"}},{default:l(()=>[e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center w-100"},{default:l(()=>[r("div",Ie,[d.includes("totalWordCount")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[n("mdi-asterisk")]),_:1})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("總字數")]),_:1})]),r("div",Oe,[e(j,{"max-width":"600px",type:"number",class:"flex-grow-1",modelValue:t(L).value.value,"onUpdate:modelValue":s[0]||(s[0]=a=>t(L).value.value=a),"error-messages":t(L).errorMessage.value,required:""},null,8,["modelValue","error-messages"]),e(Re,{location:"bottom"},{activator:l(({props:a})=>[e(f,Q({class:"mdi mdi-lightbulb-outline"},a),null,16)]),default:l(()=>[Ae]),_:1})])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("title")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[n("mdi-asterisk")]),_:1})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("故事名")]),_:1}),e(j,{"max-width":"600px",class:"flex-grow-1",modelValue:t(k).value.value,"onUpdate:modelValue":s[1]||(s[1]=a=>t(k).value.value=a),"error-messages":t(k).errorMessage.value,required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("chapterName")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[n("mdi-asterisk")]),_:1})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("章節名稱")]),_:1}),e(j,{class:"flex-grow-1",modelValue:t(y).value.value,"onUpdate:modelValue":s[2]||(s[2]=a=>t(y).value.value=a),"error-messages":t(y).errorMessage.value,required:""},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("content")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[n("mdi-asterisk")]),_:1})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("起始故事")]),_:1}),e(Pe,{class:"flex-grow-1",counter:M.value,modelValue:t(C).value.value,"onUpdate:modelValue":s[3]||(s[3]=a=>t(C).value.value=a),"error-messages":t(C).errorMessage.value,maxlength:M.value,onInput:ee,required:""},null,8,["counter","modelValue","error-messages","maxlength"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("category")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[n("mdi-asterisk")]),_:1})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("投票時間")]),_:1}),e(E,{class:"flex-grow-1","hide-details":"",modelValue:t(S).value.value,"onUpdate:modelValue":s[4]||(s[4]=a=>t(S).value.value=a),"error-messages":t(S).errorMessage.value,items:ae.value,required:""},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("category")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[n("mdi-asterisk")]),_:1})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("作品分類")]),_:1}),e(E,{class:"flex-grow-1","hide-details":"",modelValue:t(B).value.value,"onUpdate:modelValue":s[5]||(s[5]=a=>t(B).value.value=a),"error-messages":t(B).errorMessage.value,items:le.value,required:""},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("chapterLabels")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[n("mdi-asterisk")]),_:1})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("作品標籤")]),_:1}),e(E,{class:"flex-grow-1",multiple:"",chips:"","hide-details":"",modelValue:t($).value.value,"onUpdate:modelValue":s[6]||(s[6]=a=>t($).value.value=a),"error-messages":t($).errorMessage.value,items:te.value,required:""},null,8,["modelValue","error-messages","items"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("state")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[n("mdi-asterisk")]),_:1})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("故事狀態")]),_:1}),e(Y,{class:"d-flex align-center flex-grow-2",row:"","hide-details":"",modelValue:t(D).value.value,"onUpdate:modelValue":s[7]||(s[7]=a=>t(D).value.value=a),"error-messages":t(D).errorMessage.value},{default:l(()=>[r("div",Be,[e(H,{label:"連載中",value:!1})])]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("show")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px"},{default:l(()=>[n("mdi-asterisk")]),_:1})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("顯示方式")]),_:1}),e(Y,{class:"d-flex align-center flex-grow-1",row:"","hide-details":"",modelValue:t(G).value.value,"onUpdate:modelValue":s[8]||(s[8]=a=>t(G).value.value=a),"error-messages":t(G).errorMessage.value},{default:l(()=>[r("div",$e,[e(H,{label:"公開",value:!0,class:"me-4"}),e(H,{label:"隱藏",value:!1})])]),_:1},8,["modelValue","error-messages"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex align-center"},{default:l(()=>[d.includes("fileRecords")?(c(),m(f,{key:0,class:"me-2",style:{color:"red"},size:"12px",icon:"mdi-asterisk"})):v("",!0),e(V,{class:"me-4 mb-0"},{default:l(()=>[n("封面圖片")]),_:1}),e(R,{modelValue:x.value,"onUpdate:modelValue":s[9]||(s[9]=a=>x.value=a),"raw-model-value":P.value,"onUpdate:rawModelValue":s[10]||(s[10]=a=>P.value=a),accept:"image/jpeg,image/png",deletable:"","max-size":"1MB","help-text":"選擇檔案或拖曳到這裡","error-text":{type:"檔案格式不支援",size:"檔案大小不能超過 1MB"},ref_key:"fileAgent",ref:T},null,8,["modelValue","raw-model-value"])]),_:1})]),_:1}),e(g,null,{default:l(()=>[e(p,{cols:"12",class:"d-flex justify-center"},{default:l(()=>[e(he,{type:"submit",loading:t(z),style:{"background-color":"#4e9194",color:"#ffffff"}},{default:l(()=>[n("發布")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1})}}},sl=Te(De,[["__scopeId","data-v-ccd0c518"]]);export{sl as default};
