import{a2 as Nt,O as At,P as d,Q as C,R as e,c as t,V as zt,a0 as o,a3 as H,T as f,Y as p,a4 as R,a5 as q,M as pt,x as T,a6 as ft,o as K,$ as a,Z as W,S as N,G as F,U as w,W as j,X as A,a7 as tt,a8 as et,N as Mt,A as Dt,a9 as Et,aa as J,ab as Bt,_ as Ut,ac as Pt,ad as Ft,ae as Rt,af as Lt,ag as Ot}from"./index-C-DnEeCt.js";import{_ as at}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Wt}from"./VChip-BXmzA5kB.js";import{c as Ht,a as rt,u as qt,b as ct}from"./vee-validate.esm-DkPM5EVU.js";import{V as Gt}from"./VMenu-C_jSG196.js";import{V as mt,a as _t,b as ht}from"./VList-CpGmHxnA.js";import{V as Yt,a as Qt,b as ut,c as Xt}from"./VExpansionPanels-DqILbdZS.js";import{V as k,a as i}from"./VRow-BrEUpKD3.js";import{V as Zt}from"./VForm-BGNGwPLF.js";import{V as Jt}from"./VTextarea-uDXSYWgx.js";import{V as U}from"./VContainer-0UolPNUc.js";import{V as P}from"./VDivider-C3Bxt46c.js";import"./VSlideGroup-CoLXDBZp.js";const Kt={class:"d-flex justify-space-between align-center"},te={__name:"BookCard",props:["_id","image","title","category","mainAuthor","content"],setup(s){const m=Nt(),n=l=>{m.push(l)};return(l,h)=>{const V=At("router-link");return d(),C(q,{class:"pa-3 customMargin",width:"220"},{default:e(()=>[t(V,{to:"/stories/"+s._id},{default:e(()=>[t(zt,{class:"cursor-pointer",height:"150px",src:s.image,cover:""},null,8,["src"])]),_:1},8,["to"]),o("div",Kt,[t(H,{class:"px-0 py-1 text-subtitle-1 cursor-pointer",onClick:h[0]||(h[0]=b=>n("/123"))},{default:e(()=>[f(p(s.title),1)]),_:1}),t(Wt,{density:"compact",color:"primary",label:"",style:{"font-size":"12px",padding:"2px 6px"}},{default:e(()=>[f(p(s.category),1)]),_:1})]),t(R,{class:"pa-0 cursor-pointer",style:{"font-size":"12px",color:"#4e9194"},onClick:h[1]||(h[1]=b=>n("/1234"))},{default:e(()=>{var b;return[f(p((b=s.mainAuthor)==null?void 0:b.username),1)]}),_:1}),t(R,{class:"pa-0"},{default:e(()=>[f(p(s.content[0].content[0]),1)]),_:1})]),_:1})}}},it=at(te,[["__scopeId","data-v-f2bd186d"]]);function ee(s){return{all:s=s||new Map,on:function(m,n){var l=s.get(m);l?l.push(n):s.set(m,[n])},off:function(m,n){var l=s.get(m);l&&(n?l.splice(l.indexOf(n)>>>0,1):s.set(m,[]))},emit:function(m,n){var l=s.get(m);l&&l.slice().map(function(h){h(n)}),(l=s.get("*"))&&l.slice().map(function(h){h(m,n)})}}}const gt=ee(),ae={class:"title-row"},se={class:"title-text"},oe={class:"card-title my-1"},le={class:"vote-section"},ne={class:"vote-count text-body-2"},re={__name:"VoteItem",props:["content","chapterName","author","voteCount","storyId","extensionId","voteStatus"],setup(s){const{apiAuth:m}=et(),n=pt(),l=T([{title:"檢舉"},{title:"刪除"}]),h=T(!1),V=s,{content:b,author:c,voteStatus:x,voteCount:$,storyId:I,extensionId:G}=ft(V),Y=n.userId,M=K(()=>$.value.includes(Y)),D=async E=>{try{const _=await m.patch(`/story/${I.value}/${G.value}`,{voteCountChange:E});console.log(_.data.message),_.data.hasVotedInOtherExtension||(h.value=!0),gt.emit("updateStory")}catch(_){console.log(_),console.error("Error updating vote count:",_)}};return(E,_)=>(d(),C(q,{class:"w-100 px-6 py-2 rounded-lg",style:{border:"1px solid #48a9a6",margin:"16px 0px"}},{default:e(()=>[t(H,{class:"pa-0"},{default:e(()=>{var y;return[o("div",ae,[o("div",se,[o("h1",oe,p((y=a(c))==null?void 0:y.username),1)]),o("div",le,[t(W,{class:"vote-icon",size:"20"},{default:e(()=>[f("mdi-vote")]),_:1}),o("span",ne,p(s.voteCount.length),1),t(Gt,{location:"end"},{activator:e(({props:z})=>[t(N,F({icon:""},z,{class:"menu-btn",style:{width:"30px",height:"30px",padding:"auto"},variant:"plain"}),{default:e(()=>[t(W,{size:"20"},{default:e(()=>[f("mdi-dots-vertical")]),_:1})]),_:2},1040)]),default:e(()=>[t(mt,{class:"pa-0"},{default:e(()=>[(d(!0),w(j,null,A(l.value,(z,Q)=>(d(),C(_t,{key:Q,class:""},{default:e(()=>[t(ht,null,{default:e(()=>[f(p(z.title),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})])])]}),_:1}),t(R,{class:"pa-0 mx-7 py-1"},{default:e(()=>{var y;return[f(p((y=a(b))==null?void 0:y[0].latestContent),1)]}),_:1}),t(tt,{class:"d-flex justify-end"},{default:e(()=>[t(N,{disabled:a(M)||a(x).hasVoted,style:{"background-color":"#f24e1e",color:"white"},onClick:_[0]||(_[0]=y=>D(1))},{default:e(()=>[f("投票")]),_:1},8,["disabled"]),t(N,{disabled:!a(M)||a(x).hasVoted&&!a(x).voteThis,style:{"background-color":"#f4b942",color:"black","margin-right":"24px"},onClick:_[1]||(_[1]=y=>D(-1))},{default:e(()=>[f("取消")]),_:1},8,["disabled"])]),_:1})]),_:1}))}},ce=at(re,[["__scopeId","data-v-fc0b05bb"]]),L=s=>(Lt("data-v-66e46c73"),s=s(),Ot(),s),ue={class:"text--muted"},ie={class:"font-weight-black",style:{"font-size":"16px","margin-right":"4px"}},de=L(()=>o("br",null,null,-1)),pe={key:0,class:"text--danger my-2 d-inline-block font-weight-black",style:{"font-size":"12px"}},fe=L(()=>o("br",null,null,-1)),me={style:{color:"#4e9194","margin-right":"10px","font-size":"14px"}},_e=L(()=>o("br",null,null,-1)),he={key:0,class:"my-2 d-inline-block",style:{color:"black","margin-right":"10px"}},ge=L(()=>o("br",null,null,-1)),ve={style:{color:"black","margin-right":"10px"}},xe=L(()=>o("h1",null,"故事投票",-1)),ye={__name:"StoryItem",props:["category","title","chapterName","mainAuthor","content","createdAt","extensions","_id","voteTime","voteStart","voteEnd"],emits:["update"],setup(s,{emit:m}){const l=pt().userId,h=m,{apiAuth:V}=et(),b=T("");let c=0;const x=Mt(),$=T(10),I=T(50),G=Ht({newChapterName:rt().required("章節名稱必填").min(1).max(60),newChapterContent:rt().required("故事內容必填").min($.value,`故事內容不能少於 ${$.value} 字`).max(I.value,`故事內容不能超過 ${I.value} 字`)}),{handleSubmit:Y,isSubmitting:M}=qt({validationSchema:G,initialValues:{newChapterContent:""}}),D=ct("newChapterName"),E=ct("newChapterContent"),_=T(!1),y=T(!1),z=s,{category:Q,title:vt,chapterName:xt,mainAuthor:yt,content:O,createdAt:bt,_id:X}=z,{extensions:S,voteTime:Ie,voteStart:Se,voteEnd:st}=ft(z),Vt=()=>{_.value=!_.value},wt=K(()=>_.value?"mdi-heart":"mdi-heart-outline"),Ct=async()=>{try{const{data:g}=await api.get("/story");stories.value.splice(0,stories.value.length,...g.result.data)}catch(g){console.log(g)}},kt=()=>{y.value=!0},$t=K(()=>[g=>g.length>=$.value&&g.length<=I.value||`內容字數需在 ${$.value} 至 ${I.value} 字之間`]),It=()=>{const g=Date.now(),r=new Date(st.value).getTime()-g;if(r<=0){clearInterval(c),b.value="投票已結束";return}const u=Math.floor(r/1e3),Z=Math.floor(u/(24*3600)),ot=Math.floor(u%(24*3600)/3600),lt=Math.floor(u%3600/60),nt=u%60,B=[];Z>0&&B.push(`${Z} 天`),ot>0&&B.push(`${ot} 小時`),lt>0&&B.push(`${lt} 分`),nt>0&&B.push(`${nt} 秒`),b.value=B.join(" ")},St=()=>{c=setInterval(()=>{It()},1e3)};Dt(()=>{st&&St()});const jt=Y(async g=>{var v,r;try{console.log(X),await V.post(`/story/${X}`,{chapterName:g.newChapterName,content:g.newChapterContent}),x({text:"延伸內容提交成功",snackbarProps:{color:"green"}}),y.value=!1,h("update")}catch(u){console.log(u),x({text:((r=(v=u==null?void 0:u.response)==null?void 0:v.data)==null?void 0:r.message)||"發生錯誤",snackbarProps:{color:"red"}})}});Et(()=>{clearInterval(c)});const Tt=g=>{let v=!1,r=!1;for(const u of S.value)u.voteCount.indexOf(l)>-1&&(v=!0,u._id===g._id&&(r=!0));return{hasVoted:v,voteThis:r}};return(g,v)=>(d(),C(Xt,{class:"customMb"},{default:e(()=>[t(Yt,null,{default:e(()=>[t(Qt,null,{default:e(()=>[t(k,{"no-gutters":""},{default:e(()=>[t(i,{class:"d-flex align-center justify-center text--secondary",style:{"padding-right":"24px"},cols:"1"},{default:e(()=>[o("div",ue,p(a(Q)),1)]),_:1}),t(i,{cols:"8",class:"text--secondary"},{default:e(()=>[o("span",ie,p(a(vt)),1),de,a(S)&&a(S).length>0?(d(),w("span",pe,"投票倒數計時：")):J("",!0),fe,o("span",null,p(a(xt)),1)]),_:1}),t(i,{cols:"3",class:"text-right",style:{color:"#4e9194"}},{default:e(()=>{var r;return[o("span",me,p((r=a(yt))==null?void 0:r.username),1),_e,a(S)&&a(S).length>0?(d(),w("span",he,p(b.value),1)):J("",!0),ge,o("span",ve,p(new Date(a(bt)).toLocaleString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})),1)]}),_:1})]),_:1})]),_:1}),t(ut,null,{default:e(()=>[t(k,{style:{padding:"12px"}},{default:e(()=>[t(i,{cols:"12",class:"mt-1 pa-0",style:{"font-size":"8px"}},{default:e(()=>[o("h1",null,p(a(O)[0].latestContent?"最新內容":"開始故事"),1)]),_:1}),t(i,{cols:"12"},{default:e(()=>[t(k,null,{default:e(()=>[t(i,{cols:"1",class:"d-flex align-center justify-center pa-0"},{default:e(()=>[t(N,{text:"",ripple:!1,variant:"text",class:Bt(["heart-button pa-0",{filled:_.value}]),onClick:Vt},{default:e(()=>[t(W,null,{default:e(()=>[f(p(wt.value),1)]),_:1})]),_:1},8,["class"])]),_:1}),t(i,{cols:"11",class:"pl-0"},{default:e(()=>{var r;return[o("p",null,p(a(O)[0].latestContent?a(O)[0].latestContent:(r=a(O)[0])==null?void 0:r.content[0]),1),t(tt,null,{default:e(()=>[t(Ut),t(N,{color:"secondary",variant:"outlined",onClick:kt},{default:e(()=>[f(" 延續故事 ")]),_:1})]),_:1}),t(Pt,{modelValue:y.value,"onUpdate:modelValue":v[2]||(v[2]=u=>y.value=u),"max-width":"500"},{default:e(()=>[t(Zt,{onSubmit:Ft(a(jt),["prevent"]),disabled:a(M)},{default:e(()=>[t(q,null,{default:e(()=>[t(H,{class:"text-center",style:{"background-color":"#97d8c4"}},{default:e(()=>[f("延續故事")]),_:1}),t(R,{class:"py-4 pb-0"},{default:e(()=>[t(Rt,{modelValue:a(D).value.value,"onUpdate:modelValue":v[0]||(v[0]=u=>a(D).value.value=u),class:"mb-4",label:"輸入章節名稱","hide-details":"",minlength:1,maxlength:60},null,8,["modelValue"]),t(Jt,{modelValue:a(E).value.value,"onUpdate:modelValue":v[1]||(v[1]=u=>a(E).value.value=u),label:`故事內容（字數：${$.value} - ${I.value} 字`,rows:"10",minlength:`${$.value}`,maxlength:`${I.value}`,counter:"",rules:$t.value,style:{"margin-bottom":"8px"}},null,8,["modelValue","label","minlength","maxlength","rules"])]),_:1}),t(tt,{class:"justify-center align-start py-0"},{default:e(()=>[t(N,{style:{"background-color":"#4e9194",color:"#000000"},type:"submit",loading:a(M)},{default:e(()=>[f("發布")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(S)&&a(S).length>0?(d(),C(ut,{key:0},{default:e(()=>[t(i,{cols:"12",class:"mt-1 mb-3 pa-0",style:{"font-size":"8px"}},{default:e(()=>[xe]),_:1}),(d(!0),w(j,null,A(a(S).slice(0,5),(r,u)=>(d(),C(ce,{key:u,storyId:a(X),extensionId:r._id,content:r.content,chapterName:r.chapterName,author:r.author,voteCount:r.voteCount,voteStatus:Tt(r),onUpdate:Ct},null,8,["storyId","extensionId","content","chapterName","author","voteCount","voteStatus"]))),128))]),_:1})):J("",!0)]),_:1})]),_:1}))}},dt=at(ye,[["__scopeId","data-v-66e46c73"]]),be={class:"pa-0 px-4"},Ve=o("h2",null,"追蹤故事",-1),we=o("h2",null,"熱門故事",-1),Ce=o("h2",null,"最新故事",-1),ke=o("h2",null,"完結故事",-1),$e=o("h2",null,"創作資源區",-1),Le={__name:"index",setup(s){const{api:m}=et(),n=T([]),l=async()=>{try{const{data:V}=await m.get("/story");n.value.splice(0,n.value.length,...V.result.data)}catch(V){console.log(V)}},h=[{to:"/articleArea",icon:"mdi-lightbulb-on-outline",title:"創作指引",color:"#F9A825"}];return l(),gt.on("updateStory",l),(V,b)=>(d(),w(j,null,[t(k,null,{default:e(()=>[t(i,{cols:"12"},{default:e(()=>[t(q,{class:"rounded-0 px-10 py-auto",height:"200px",color:"surface-variant",image:"https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=2948&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D",cover:"",elevation:"5"},{default:e(()=>[t(i,null,{default:e(()=>[t(H,{class:"text-h4 font-weight-bold"},{default:e(()=>[f(" 歡迎來到界筆！ ")]),_:1}),t(R,{class:"font-weight-bold pa-0 py-2 px-4 mb-2",style:{"font-size":"24px","letter-spacing":"12px"}},{default:e(()=>[f(" 探索和創作無限可能的故事 ")]),_:1}),o("div",be,[t(N,{class:"font-weight-black mr-3 px-4",variant:"elevated",color:"#CCB78E",to:"/createStory"},{default:e(()=>[f(" 立即創作 ")]),_:1}),t(N,{class:"font-weight-black px-4",outlined:"",border:"",variant:"elevated",style:{color:"#ccb78e",border:"1px solid #ccb78e","background-color":"rgba(0, 0, 0, 0.47)"},to:"/category"},{default:e(()=>[f(" 探索故事 ")]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t(k,{class:"justify-space-between"},{default:e(()=>[t(i,{cols:"12",class:"pb-0"},{default:e(()=>[Ve]),_:1}),t(P,{class:"mb-3"}),t(i,{cols:"12",class:"d-flex flex-column justify-space-between"},{default:e(()=>[(d(!0),w(j,null,A(n.value,(c,x)=>(d(),C(dt,F({key:x,ref_for:!0},c,{onUpdate:l}),null,16))),128))]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t(k,{class:"justify-space-between"},{default:e(()=>[t(i,{cols:"12",class:"pb-0"},{default:e(()=>[we]),_:1}),t(P,{class:"mb-3"}),t(i,{cols:"12",class:"d-flex flex-row justify-start"},{default:e(()=>[(d(!0),w(j,null,A(n.value,c=>(d(),C(it,F({key:c._id,ref_for:!0},c),null,16))),128))]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t(k,{class:"justify-space-between"},{default:e(()=>[t(i,{cols:"12",class:"pb-0"},{default:e(()=>[Ce]),_:1}),t(P,{class:"mb-3"}),t(i,{cols:"12",class:"d-flex flex-column justify-space-between"},{default:e(()=>[(d(!0),w(j,null,A(n.value,(c,x)=>(d(),C(dt,F({key:x,ref_for:!0},c,{onUpdate:l}),null,16))),128))]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t(k,{class:"justify-space-between"},{default:e(()=>[t(i,{cols:"12",class:"pb-0"},{default:e(()=>[ke]),_:1}),t(P,{class:"mb-3"}),t(i,{cols:"12",class:"d-flex flex-row justify-space-between"},{default:e(()=>[(d(!0),w(j,null,A(n.value,c=>(d(),C(it,F({key:c._id,ref_for:!0},c),null,16))),128))]),_:1})]),_:1})]),_:1}),t(U,{style:{padding:"32px"}},{default:e(()=>[t(k,{class:"justify-space-between"},{default:e(()=>[t(i,{cols:"12",class:"pb-0"},{default:e(()=>[$e]),_:1}),t(P,{class:"mb-3"}),t(i,{cols:"12",class:"d-flex flex-row justify-space-between py-0"},{default:e(()=>[t(mt,{class:"d-flex justify-space-between w-100 py-0",style:{"background-color":"transparent"}},{default:e(()=>[(d(),w(j,null,A(h,(c,x)=>t(_t,{key:x,to:c.to,link:""},{prepend:e(()=>[t(W,{size:"80",color:c.color},{default:e(()=>[f(p(c.icon),1)]),_:2},1032,["color"])]),default:e(()=>[t(ht,{style:{"font-size":"20px","font-weight":"bold"},textContent:p(c.title)},null,8,["textContent"])]),_:2},1032,["to"])),64))]),_:1})]),_:1})]),_:1})]),_:1})],64))}};export{Le as default};
